<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2025-05-22T00:04:28+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">SUJIN DEV NOTE ğŸ“</title><subtitle>ì£¼ë‹ˆì–´ ê°œë°œìì˜ ê¼¼ì§ˆê¼¼ì§ˆ ì„±ì¥ì¼ì§€ ğŸ‘»</subtitle><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><entry><title type="html">[NestJS] ë‚´ê°€ EC2ì„œë²„ì—ì„œ CORS ì—ëŸ¬ì§€ì˜¥ì— ê°‡í˜”ë˜ ì´ìœ (ëŠ” NGINX) + EC2/NextJS/PM2 ë°°í¬ ê°€ì´ë“œ</title><link href="http://localhost:4000/nestjs/nestjs-%EB%82%B4%EA%B0%80-EC2%EC%84%9C%EB%B2%84%EC%97%90%EC%84%9C-CORS-%EC%97%90%EB%9F%AC%EC%A7%80%EC%98%A5%EC%97%90-%EA%B0%87%ED%98%94%EB%8D%98-%EC%9D%B4%EC%9C%A0(%EB%8A%94-NginX)/" rel="alternate" type="text/html" title="[NestJS] ë‚´ê°€ EC2ì„œë²„ì—ì„œ CORS ì—ëŸ¬ì§€ì˜¥ì— ê°‡í˜”ë˜ ì´ìœ (ëŠ” NGINX) + EC2/NextJS/PM2 ë°°í¬ ê°€ì´ë“œ" /><published>2025-05-19T00:00:00+09:00</published><updated>2025-05-19T22:06:00+09:00</updated><id>http://localhost:4000/nestjs/nestjs-%EB%82%B4%EA%B0%80%20EC2%EC%84%9C%EB%B2%84%EC%97%90%EC%84%9C%20CORS%20%EC%97%90%EB%9F%AC%EC%A7%80%EC%98%A5%EC%97%90%20%EA%B0%87%ED%98%94%EB%8D%98%20%EC%9D%B4%EC%9C%A0(%EB%8A%94%20NginX)</id><content type="html" xml:base="http://localhost:4000/nestjs/nestjs-%EB%82%B4%EA%B0%80-EC2%EC%84%9C%EB%B2%84%EC%97%90%EC%84%9C-CORS-%EC%97%90%EB%9F%AC%EC%A7%80%EC%98%A5%EC%97%90-%EA%B0%87%ED%98%94%EB%8D%98-%EC%9D%B4%EC%9C%A0(%EB%8A%94-NginX)/"><![CDATA[<p><img src="/assets/image/nginx.png" alt="image" /></p>

<h2 id="-ë°°ê²½">â—¾ ë°°ê²½</h2>
<p>ì´ì „ì— íšŒì‚¬ì—ì„œ NextJS í”„ë¡œì íŠ¸ë¥¼ EC2 ì„œë²„ì— ë°°í¬í•˜ë©° ê³ ìƒí–ˆë˜ ê²½í—˜ì´ ìˆìŠµë‹ˆë‹¤. 
ì´ë²ˆì—ëŠ” NestJS ë¼ê³  ë³„ê±° ìˆê² ëƒë©° ê²ë‚˜ëŠ” ë§ˆìŒì„ ì†ì´ë©° ë°°í¬ë¥¼ ì§„í–‰í•˜ê²Œ ë˜ì—ˆê³ , ê·¸ë•Œ ë‚˜ë¥¼ í˜ë“¤ê²Œ í–ˆë˜ NGINXë¼ëŠ” ì¹œêµ¬ì™€ ë‹¤ì‹œ ë§Œë‚˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<p>ê·¸ë ‡ê²Œ ë‹¤ì‹œ í˜¼ì­ì´ë‚˜ë©´ì„œ ê²ªì—ˆë˜ ê³¼ì •ì„ ë‚¨ê²¨ë´…ë‹ˆë‹¤.</p>

<h2 id="-ë‚´ê°€-nginxë¥¼-ì„ íƒí•œ-ì´ìœ ---https-í†µì‹ ì„-í•˜ê¸°-ìœ„í•´ì„œ">â—¾ ë‚´ê°€ NGINXë¥¼ ì„ íƒí•œ ì´ìœ  - HTTPS í†µì‹ ì„ í•˜ê¸° ìœ„í•´ì„œ</h2>
<p>Rebook í”„ë¡œì íŠ¸ì˜ í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ëŠ” AWS Amplifyë¥¼ í†µí•´ ê°„í¸í•˜ê²Œ ë°°í¬í–ˆìŠµë‹ˆë‹¤.
AmplifyëŠ” ëª¨ë“  ë°°í¬ ë„ë©”ì¸ì— <strong>HTTPSê°€ ì ìš©ëœ ë³´ì•ˆ ì¸ì¦ì„œ</strong>ë¥¼ ê¸°ë³¸ ì œê³µí•©ë‹ˆë‹¤.</p>

<p>ë°˜ë©´, ë°±ì—”ë“œ ì„œë²„ëŠ” EC2ë¥¼ ì‚¬ìš©í–ˆìœ¼ë©°, ë³„ë„ì˜ ì„¤ì • ì—†ì´ ê¸°ë³¸ì ìœ¼ë¡œ <strong>HTTP ë„ë©”ì¸</strong>ë§Œ ì œê³µí•©ë‹ˆë‹¤.</p>

<p>ì´ ë•Œ, í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ì™€ ë°±ì—”ë“œ ì„œë²„ ì‚¬ì´ì—ëŠ” Mixed Content ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>

<h3 id="mixed-content-ì—ëŸ¬ë€">ğŸ“šMixed Content ì—ëŸ¬ë€?</h3>

<ul>
  <li>HTTPS í˜ì´ì§€ì—ì„œ HTTP ë¦¬ì†ŒìŠ¤ë¥¼ ìš”ì²­í•  ë•Œ ë°œìƒí•˜ëŠ” ë³´ì•ˆ ì—ëŸ¬</li>
  <li>ì•”í˜¸í™”ë˜ì§€ ì•Šì€ ë°ì´í„° ì „ì†¡ìœ¼ë¡œ ë³´ì•ˆ ìœ„í˜‘ì´ ë°œìƒí•  ìˆ˜ ìˆì–´, ë¸Œë¼ìš°ì €ê°€ ìš”ì²­ ìì²´ë¥¼ ì°¨ë‹¨í•¨</li>
  <li>í•´ê²° ë°©ë²•
    <ul>
      <li>ë„ë©”ì¸ì„ ë°œê¸‰í•˜ê³ , SSL ì¸ì¦ì„œë¥¼ ì ìš©í•´ ë°±ì—”ë“œ ì„œë²„ë„ HTTPSë¡œ í†µì‹ í•˜ë„ë¡ ì„¤ì •í•˜ì!</li>
    </ul>
  </li>
</ul>

<p>NestJSì—ì„œë„ SSL ì¸ì¦ì„œë¥¼ ë‹¤ë£° ìˆ˜ ìˆì§€ë§Œ, ì—­í• ì„ êµ¬ë¶„í•˜ê³  ì„œë²„ì— ê°€í•´ì§€ëŠ” ë¶€ë‹´ì„ ê°ì†Œí•˜ê¸° ìœ„í•´ NGINXë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤.</p>

<h3 id="-nginxì˜-ì—­í• ">ğŸ“š NGINXì˜ ì—­í• </h3>
<ul>
  <li>SSL ì¸ì¦ì„œ ê´€ë¦¬
    <ul>
      <li>Letâ€™s Encrypt ê°™ì€ ë¬´ë£Œ ì¸ì¦ì„œë¥¼ ìë™ìœ¼ë¡œ ê°±ì‹ </li>
      <li>ì¸ì¦ì„œì˜ ì•”í˜¸í™”/ë³µí˜¸í™”</li>
    </ul>
  </li>
  <li>ì¸í”„ë¼ ê´€ë¦¬ í‘œì¤€ íŒ¨í„´ ì‚¬ìš© (TLS Termination)</li>
  <li>ê°„í¸í•œ í¬íŠ¸ ê´€ë¦¬ ë° ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ
    <ul>
      <li>NGINXê°€ 80/443 í¬íŠ¸ì—ì„œ ìš”ì²­ì„ ë°›ê³ , ë‚´ë¶€ì ìœ¼ë¡œ NestJS ì„œë²„ë¡œ í”„ë¡ì‹œ ìš”ì²­ì„ ì „ë‹¬í•¨.</li>
      <li>NestJS ì„œë²„ í¬íŠ¸ ë…¸ì¶œ ì—†ì´ ë³´ì•ˆì„±ê³¼ ìœ ì—°ì„± í™•ë³´</li>
    </ul>
  </li>
</ul>

<p>ê·¸ë ‡ê²Œ NGINXì˜ ì„¤ì •ê¹Œì§€ ë§ˆì¹œ ì €ëŠ” ë‘ê°€ì§€ CORSì—ëŸ¬ë¥¼ ë§ˆì£¼í•˜ê²Œ ë©ë‹ˆë‹¤.</p>

<h2 id="-í”„ë¦¬í”Œë¼ì´íŠ¸options-ìš”ì²­-ì‹¤íŒ¨">â—¾ í”„ë¦¬í”Œë¼ì´íŠ¸(OPTIONS) ìš”ì²­ ì‹¤íŒ¨</h2>

<h3 id="ë¬¸ì œ-ìƒí™©">ğŸ“ë¬¸ì œ ìƒí™©</h3>

<ul>
  <li>ë³¸ ìš”ì²­ ì„±ê³µì ìœ¼ë¡œ ë„ë‹¬í•˜ê¸° ì „ì—, í”„ë¦¬í”Œë¼ì´íŠ¸ ìš”ì²­ì´ 404ì‘ë‹µìœ¼ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.</li>
</ul>

<p><img src="/assets/image/posts/cors-option.png" alt="image" /></p>

<h3 id="ë¬¸ì œ-ì›ì¸">ğŸ“ë¬¸ì œ ì›ì¸</h3>

<p>ë¬¸ì œì˜ ì›ì¸ì„ ì°¾ê³ ì NGINX í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-[<span class="s2">"be ì„œë²„ ë„ë©”ì¸"</span><span class="o">]</span>:~/rebook-api<span class="nv">$ </span><span class="nb">sudo </span>nginx <span class="nt">-t</span>
2025/05/17 09:43:14 <span class="o">[</span>warn] 75575#75575: conflicting server name <span class="s2">"be ì„œë²„ ë„ë©”ì¸"</span> on 0.0.0.0:80, ignored // âœ…
2025/05/17 09:43:14 <span class="o">[</span>warn] 75575#75575: conflicting server name <span class="s2">"be ì„œë²„ ë„ë©”ì¸"</span> on 0.0.0.0:443, ignored // âœ…
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test </span>is successful
</code></pre></div></div>
<p><br /></p>

<p><strong>80 í¬íŠ¸ì™€ 443 í¬íŠ¸ì—ì„œ ì¶©ëŒ</strong>ì´ ë‚˜ì„œ ìš”ì²­ì´ ë¬´ì‹œë˜ì—ˆë‹¤ëŠ” ë©”ì„¸ì§€ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
ì´ ì„¤ì •ì„ ì‘ì„±í•œ NGINX ì„¤ì •íŒŒì¼ì„ í™•ì¸í•©ë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-172-31-13-63:~/rebook-api<span class="nv">$ </span><span class="nb">sudo ls</span> <span class="nt">-l</span> /etc/nginx/sites-enabled/
total 0
lrwxrwxrwx 1 root root 34 May 15 09:46 default -&gt; /etc/nginx/sites-available/default
lrwxrwxrwx 1 root root 33 May 17 07:35 rebook -&gt; /etc/nginx/sites-available/rebook
</code></pre></div></div>

<p>ê¸°ë³¸(default)ì„¤ì • íŒŒì¼ì— 80/443 í¬íŠ¸ìš© server ë¸”ë¡ì´ ì¤‘ë³µ ì„ ì–¸ë˜ì–´, HTTPS ìš”ì²­ì€ ìˆ˜ì‹ ë˜ì§€ë§Œ ì‹¤ì œ ì²˜ë¦¬ë¥¼ ëª»í–ˆìŠµë‹ˆë‹¤.</p>

<p>ì¦‰, ë°±ì—”ë“œ ë„ë©”ì¸ì„ ì²˜ë¦¬í•˜ëŠ” <strong>server ë¸”ë¡ì´ ë™ì¼ í¬íŠ¸(80/443)ì—ì„œ ë‘ ê°œ ì´ìƒ ì„ ì–¸</strong>ë˜ì–´ ì¶©ëŒì´ ë°œìƒí–ˆë˜ ê²ƒì…ë‹ˆë‹¤.</p>

<h3 id="ë¬¸ì œ-í•´ê²°">ğŸ“ë¬¸ì œ í•´ê²°</h3>

<p><code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/default</code>ì„ ë””ë ‰í„°ë¦¬ ë‚´ì—ì„œ ì œê±°í•˜ê³ , ì˜¤ì§ <strong>í•˜ë‚˜ì˜ ì„œë²„ ë¸”ë¡ì—ì„œë§Œ 80/443 ìš”ì²­ì„ ì²˜ë¦¬</strong>í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-[<span class="s2">"be ì„œë²„ ë„ë©”ì¸"</span><span class="o">]</span>:~/rebook-api<span class="nv">$ </span><span class="nb">sudo </span>nginx <span class="nt">-t</span>
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test </span>is successful // í…ŒìŠ¤íŠ¸ ì„±ê³µ
</code></pre></div></div>

<h2 id="-nestjs-ì„œë²„ì„œ-ìš”ì²­ì„-ìˆ˜í–‰í•˜ì§€ë§Œ-ë¸Œë¼ìš°ì €ì—ëŠ”-cors-ì‘ë‹µì´-ë–¨ì–´ì ¸ìš”">â—¾ NestJS ì„œë²„ì„œ ìš”ì²­ì„ ìˆ˜í–‰í•˜ì§€ë§Œ ë¸Œë¼ìš°ì €ì—ëŠ” CORS ì‘ë‹µì´ ë–¨ì–´ì ¸ìš”</h2>
<p>ì´ ì—ëŸ¬ëŠ” ì²˜ìŒì— ì›ì¸ì„ ì§ì‘ì¡°ì°¨ í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
<ul>
  <li>Status Code:  200 OK</li>
  <li>Response: CORS ERROR</li>
</ul>

<p><img src="/assets/image/posts/cors-header-setting.png" alt="image" /></p>

<p>http-filter ì„¤ì •ë„ ë‹¤ì‹œ ë³´ê³ , CORS ì„¤ì •ë„ ë‹¤ì‹œ ë´¤ì§€ë§Œ ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì€ ì—†ì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="ë¬¸ì œ-ì›ì¸-1">ğŸ“ë¬¸ì œ ì›ì¸</h3>

<p>ìŠ¤í¬ë¦°ìƒ·ì„ ìì„¸íˆ ë³´ë©´ ì‘ë‹µ í—¤ë”ì— <strong>Access-Control-Allow-Origin í—¤ë”</strong>ê°€ ì—†ìŠµë‹ˆë‹¤.</p>

<p>ì •ë¦¬í•˜ìë©´ ì´ë ‡ìŠµë‹ˆë‹¤.</p>

<ol>
  <li>ì„œë²„ - ìš”ì²­ì„ ì •ìƒ ì²˜ë¦¬</li>
  <li>ë¸Œë¼ìš°ì € ì‘ë‹µì— CORS í—¤ë”ê°€ ì—†ì–´ì„œ ì‘ë‹µ ë¬´íš¨ ì²˜ë¦¬</li>
</ol>

<p>NestJSê°€ ì •ìƒ ì‘ë‹µì„ ë³´ëƒˆì§€ë§Œ, <strong>NGINXì—ì„œ Access-Control-Allow-Origin í—¤ë” ì„¤ì •ì„ í•˜ì§€ ì•Šì•„ ë¸Œë¼ìš°ì €ê°€ í•´ë‹¹ ì‘ë‹µì„ ì°¨ë‹¨</strong>í–ˆìŠµë‹ˆë‹¤.
NGINXë¥¼ ì„¤ì •í•  ë•ŒëŠ” ì£¼ë¡œ ë°±ì—”ë“œë¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ë§Œ ê³ ë ¤í–ˆì§€ë§Œ, ì‹¤ì œë¡œëŠ” ë¸Œë¼ìš°ì €ê°€ ì‘ë‹µì˜ í—¤ë”ë„ ê²€ì‚¬í•˜ê¸° ë•Œë¬¸ì—, ì‘ë‹µì— ëŒ€í•œ CORS ì„¤ì • ë˜í•œ ë°˜ë“œì‹œ í•„ìš”í•˜ë‹¤ëŠ” ì‚¬ì‹¤ì„ ë†“ì¹˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="ë¬¸ì œ-í•´ê²°-1">ğŸ“ë¬¸ì œ í•´ê²°</h3>

<p>ì´ ë¬¸ì œëŠ” NGINXì—ì„œ ëª¨ë“  ì‘ë‹µì— CORS í—ˆìš© í—¤ë”ë¥¼ ì¶”ê°€í•˜ë©° í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p><strong>ğŸ’¾ /etc/nginx/sites-available/rebook</strong></p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
location / <span class="o">{</span>
    add_header <span class="s1">'Access-Control-Allow-Origin'</span> <span class="s1">'[í”„ë¡ íŠ¸ ì„œë²„ ë„ë©”ì¸]'</span> always<span class="p">;</span>  // íŠ¹ì • ë„ë©”ì¸ì— í•œí•´ í—ˆìš©
    add_header <span class="s1">'Access-Control-Allow-Credentials'</span> <span class="s1">'true'</span> always<span class="p">;</span>
    add_header <span class="s1">'Access-Control-Allow-Headers'</span> <span class="s1">'Content-Type, Authorization'</span> always<span class="p">;</span>
    add_header <span class="s1">'Access-Control-Allow-Methods'</span> <span class="s1">'GET, POST, PUT, PATCH, DELETE, OPTIONS'</span> always<span class="p">;</span> // ëª¨ë“  ë©”ì„œë“œ í—ˆìš©

    <span class="k">if</span> <span class="o">(</span><span class="nv">$request_method</span> <span class="o">=</span> <span class="s1">'OPTIONS'</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return </span>204<span class="p">;</span>
    <span class="o">}</span>

    proxy_pass http://localhost:4000<span class="p">;</span>
    proxy_http_version 1.1<span class="p">;</span>
    proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
    proxy_set_header Connection <span class="s1">'upgrade'</span><span class="p">;</span>
    proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
    proxy_cache_bypass <span class="nv">$http_upgrade</span><span class="p">;</span>
<span class="o">}</span>
...
</code></pre></div></div>

<h2 id="-ê°„ë‹¨-íšŒê³ ">â—¾ ê°„ë‹¨ íšŒê³ </h2>

<p>NGINXë¥¼ ì²˜ìŒ íšŒì‚¬ì—ì„œ ì„¤ì •í•  ë•ŒëŠ” ì¸í”„ë¼ì— ëŒ€í•´ ê±°ì˜ ì•Œì§€ ëª»í•˜ë˜ ìƒíƒœì˜€ìŠµë‹ˆë‹¤.
ë‹¹ì‹œ ë§¨ëª¸ìœ¼ë¡œ ë¶€ë”ªíˆë©° ì‘ì—…í–ˆë˜ ê²½í—˜ì´ ì´ë²ˆ í”„ë¡œì íŠ¸ì— ìƒë‹¹í•œ ë„ì›€ì´ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<p>ì¸í”„ë¼ëŠ” ì²˜ìŒ ì ‘í•˜ë©´ ì–´ë µì§€ë§Œ, ì‘ì—…ì„ í•˜ë‚˜í•˜ë‚˜ ì§ì ‘ ì—°ê²°í•´ íë¦„ì´ ì™„ì„±ë˜ëŠ” ê²ƒì„ ë³´ë©´ ì†ì´ ì‹œì›í•©ë‹ˆë‹¤.
ì˜¤ëŠ˜ì˜ ê²½í—˜ì´ ë˜ ë¯¸ë˜ì—ì„œ í—¤ë§¤ê³  ìˆëŠ” ì €ì—ê²Œ ë„ì›€ì´ ë˜ê¸¸ ë°”ëë‹ˆë‹¤.</p>

<h2 id="-ì¶”ê°€-ec2--nestjs-ê°„ë‹¨ê°„ë‹¨-ë°°í¬-ê°€ì´ë“œ-ëª…ë ¹ì–´-ìœ„ì£¼">ğŸ (ì¶”ê°€) EC2 + NestJS ê°„ë‹¨ê°„ë‹¨ ë°°í¬ ê°€ì´ë“œ (ëª…ë ¹ì–´ ìœ„ì£¼)</h2>

<h3 id="a-ec2-ì„œë²„-ì„¤ì •í•˜ê¸°-aws-ec2-ì„œë²„-ìƒì„±-ìƒëµ">A. EC2 ì„œë²„ ì„¤ì •í•˜ê¸° (AWS EC2 ì„œë²„ ìƒì„± ìƒëµ)</h3>

<table>
  <tbody>
    <tr>
      <td>ìš°ë¶„íˆ¬ ê¸°ì¤€ì…ë‹ˆë‹¤.</td>
    </tr>
  </tbody>
</table>

<p>âœ… STEP 01.  EC2 ì¸ìŠ¤í„´ìŠ¤ ì ‘ê·¼ <br /></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd</span> ~/.ssh
<span class="nv">$ </span>ssh <span class="nt">-i</span> <span class="s2">"public ip ì£¼ì†Œ"</span>
</code></pre></div></div>

<p>âœ… STEP 02.  í”„ë¡œì íŠ¸ ë””ë ‰í„°ë¦¬ ì†Œìœ ì ë³€ê²½ <br /></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo chown</span> <span class="nt">-R</span> ubuntu:ubuntu <span class="o">[</span>í”„ë¡œì íŠ¸ ê²½ë¡œ]
</code></pre></div></div>
<ul>
  <li>root(ê¸°ì¡´ ì†Œìœ ì)ì—ì„œ ubuntuë¡œ ë³€ê²½</li>
</ul>

<p>âœ… STEP 03.  ecosystem.config.js ìƒì„± <br /></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">apps</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">rebook-api</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„</span>
      <span class="na">script</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./dist/src/main.js</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// ì‹¤í–‰í•  íŒŒì¼</span>
      <span class="na">instances</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// ì‹±ê¸€ ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰ (ë‹¤ì¤‘ ì‹¤í–‰ ì‹œ cluster ëª¨ë“œ ì‚¬ìš©)</span>
      <span class="na">autorestart</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// í¬ë˜ì‹œ ë°œìƒ ì‹œ ìë™ ì¬ì‹œì‘</span>
      <span class="na">watch</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// ì½”ë“œ ë³€ê²½ ê°ì§€ ë¹„í™œì„±í™” (ê°œë°œ ëª¨ë“œì—ì„œëŠ” true ê°€ëŠ¥)</span>
      <span class="na">max_memory_restart</span><span class="p">:</span> <span class="dl">'</span><span class="s1">300M</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// ë©”ëª¨ë¦¬ ì´ˆê³¼ ì‹œ ì¬ì‹œì‘</span>
      <span class="na">env</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// ğŸ’¡ ê¸°ë³¸ê°’ (ê°œë°œ í™˜ê²½)</span>
        <span class="na">NODE_ENV</span><span class="p">:</span> <span class="dl">'</span><span class="s1">development</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="na">env_production</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1">// ğŸ’¡ --env production ì‚¬ìš© ì‹œ ì ìš© (ìš´ì˜ í™˜ê²½)</span>
        <span class="na">NODE_ENV</span><span class="p">:</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">],</span>
<span class="p">};</span>
</code></pre></div></div>
<p>â­ï¸ PM2ë¡œ í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•  ë•ŒëŠ”, <a href="https://pm2.keymetrics.io/docs/usage/environment/">í™˜ê²½ë³€ìˆ˜ë¥¼ ecosystemì— ì‘ì„±</a>í•©ë‹ˆë‹¤. ë‹¤ë§Œ, githubì—ì„œëŠ” ì¤‘ìš”í•œ ì •ë³´ê°€ ìˆ¨ê²¨ì ¸ì•¼ í•˜ê¸° ë•Œë¬¸ì— EC2ì„œë²„ì—ì„œ ì§ì ‘ ì„¤ì •í•©ë‹ˆë‹¤.</p>

<h3 id="b-nginx-ì„¤ì¹˜--ssl-ì¸ì¦ì„œ-ë°œê¸‰">B. NGINX ì„¤ì¹˜ &amp; SSL ì¸ì¦ì„œ ë°œê¸‰</h3>

<p>[ğŸ“š NGINX ì‚¬ìš© ëª©ì ] <br />
â–ªï¸ <strong>HTTPS ìš”ì²­ì„ ìˆ˜ì‹ </strong> - NGINXê°€ 443 í¬íŠ¸ì—ì„œ ë¸Œë¼ìš°ì €ì˜ ìš”ì²­ì„ ìˆ˜ì‹  í›„, Letâ€™s Encrypt SSL ì¸ì¦ì„œë¥¼ ë³´ì—¬ì¤€ë‹¤.<br />
â–ªï¸ <strong>TLS í•¸ë“œì…°ì´í¬</strong> - ë¸Œë¼ìš°ì €ê°€ ê³µê°œí‚¤ë¡œ ì •ë³´ë¥¼ ì•”í˜¸í™”í•´ì„œ ë³´ë‚´ë©´ NGINXê°€ ê°œì¸í‚¤ë¡œ ë³µí˜¸í™”í•œë‹¤<br />
â–ªï¸ <strong>ë³µí˜¸í™”ëœ HTTP ìš”ì²­ì„ NestJS ì„œë²„ë¡œ ì „ë‹¬</strong> - HTTPSë¡œ ë°›ì€ ìš”ì²­ì„ HTTPë¡œ ë³€í™˜í•´ì„œ ë‚´ë¶€ NestJS ì„œë²„ì— ë³´ë‚¸ë‹¤.<br />
â–ªï¸ <strong>HTTP â†’ HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸</strong> - 80í¬íŠ¸ë¡œ HTTP ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, NGINXê°€ ìë™ìœ¼ë¡œ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•œë‹¤.<br /></p>

<p>âœ… STEP 01.  NGINX ì„¤ì¹˜</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt update <span class="c"># apt: ubuntu ëª…ë ¹ì–´ ì‹¤í–‰ ë„êµ¬</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt intall nginx <span class="nt">-y</span>

<span class="nv">$ </span><span class="nb">sudo </span>systemctl start nginx <span class="c"># (nginx ì‹¤í–‰)</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>nginx <span class="c"># (ë¶€íŒ…ì‹œ nginx ìë™ ì‹¤í–‰)</span>
</code></pre></div></div>
<p><br /></p>

<p>âœ… STEP 02. SSL ì¸ì¦ì„œ ë°œê¸‰</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>certbot python3-certbot-nginx <span class="nt">-y</span>
<span class="nv">$ </span><span class="nb">sudo </span>nginx <span class="nt">-t</span> <span class="c"># (NGINX ì„¤ì • í…ŒìŠ¤íŠ¸)</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl reload nginx <span class="c"># (ë³€ê²½ëœ ì„¤ì • ì ìš©)</span>
<span class="nv">$ </span>curl <span class="nt">-I</span> <span class="o">[</span>ë°±ì—”ë“œ ë„ë©”ì¸ ì£¼ì†Œ] <span class="c"># (HTTPS ì •ìƒ ë™ì‘ í…ŒìŠ¤íŠ¸)</span>
<span class="nv">$ </span><span class="nb">sudo </span>systemctl <span class="nb">enable </span>certbot timer <span class="c"># (SSL ì¸ì¦ì„œ ìë™ ê°±ì‹  ì„¤ì •)</span>
</code></pre></div></div>
<p>â–ªï¸ certbot: ë¬´ë£Œ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ê³  ìë™ìœ¼ë¡œ NGINXì— ì ìš©. ì¸ì¦ì„œ ë°œê¸‰ ë„êµ¬.<br />
â–ªï¸ python3-certbot-nginx: NGINXì™€ certbotì„ ì—°ë™í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸<br />
â–ªï¸ -y: ì„¤ì¹˜ ì¤‘ ì‚¬ìš©ì í™•ì¸ ìƒëµí•˜ê³  ìë™ ì§„í–‰<br /></p>

<h3 id="c-nginx-ssl-reverse-proxy-ì„¤ì •">C. NGINX SSL Reverse Proxy ì„¤ì •</h3>

<p>âœ… STEP 01. NGINX ì„¤ì •íŒŒì¼ ìƒì„±</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>nano /etc/nginx/sites-available/[ìƒì„±í•  ì„¤ì •íŒŒì¼ ëª…]
</code></pre></div></div>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ğŸ’¾ /etc/nginx/sites-available/[ìƒì„±í•  ì„¤ì •íŒŒì¼ ëª…]

<span class="c"># HTTP ìš”ì²­ì€ ë¬´ì¡°ê±´ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸</span>

server <span class="o">{</span>
    listen 80<span class="p">;</span>
    server_name www.rebook.p-e.kr<span class="p">;</span>

    <span class="k">return </span>301 https://<span class="nv">$host$request_uri</span><span class="p">;</span>
<span class="o">}</span>

<span class="c"># HTTPS ì²˜ë¦¬ ì„œë²„ ë¸”ë¡</span>
server <span class="o">{</span>
    listen 443 ssl<span class="p">;</span>
    server_name <span class="o">[</span>ë°±ì—”ë“œ ì„œë²„ ë„ë©”ì¸ ì£¼ì†Œ]<span class="p">;</span>

    ssl_certificate /etc/letsencrypt/live/www.rebook.p-e.kr/fullchain.pem<span class="p">;</span>
    ssl_certificate_key /etc/letsencrypt/live/www.rebook.p-e.kr/privkey.pem<span class="p">;</span>
    ssl_protocols TLSv1.2 TLSv1.3<span class="p">;</span>
    ssl_ciphers HIGH:!aNULL:!MD5<span class="p">;</span>

    location / <span class="o">{</span>
        <span class="c"># âœ… ëª¨ë“  ì‘ë‹µì— CORS í—¤ë” ì¶”ê°€ </span>
        add_header <span class="s1">'Access-Control-Allow-Origin'</span> <span class="s1">'[í”„ë¡ íŠ¸ ì„œë²„ ë„ë©”ì¸ ì£¼ì†Œ]'</span> always<span class="p">;</span>
        add_header <span class="s1">'Access-Control-Allow-Credentials'</span> <span class="s1">'true'</span> always<span class="p">;</span>
        add_header <span class="s1">'Access-Control-Allow-Headers'</span> <span class="s1">'Content-Type, Authorization'</span> always<span class="p">;</span>
        add_header <span class="s1">'Access-Control-Allow-Methods'</span> <span class="s1">'GET, POST, PUT, PATCH, DELETE, OPTIONS'</span> always<span class="p">;</span>

        <span class="k">if</span> <span class="o">(</span><span class="nv">$request_method</span> <span class="o">=</span> <span class="s1">'OPTIONS'</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return </span>204<span class="p">;</span>
       <span class="o">}</span>

        proxy_pass http://localhost:4000<span class="p">;</span>  <span class="c"># NestJS ì„œë²„</span>
        proxy_http_version 1.1<span class="p">;</span>
        proxy_set_header Upgrade <span class="nv">$http_upgrade</span><span class="p">;</span>
        proxy_set_header Connection <span class="s1">'upgrade'</span><span class="p">;</span>
        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
        proxy_cache_bypass <span class="nv">$http_upgrade</span><span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>âœ… STEP 02. NGINX ì‹¬ë³¼ë§ ë§í¬ ì„¤ì •</p>

<p>[ğŸ“š NGINX ì‹¬ë³¼ë¦­ ë§í¬ ì‚¬ìš© ëª©ì ] <br />
â–ªï¸ /etc/nginx/sites-available/ : ì„¤ì • íŒŒì¼ ë³´ê´€ì†Œ (ì‹¤ì œ ë‚´ìš© ì‘ì„±) <br />
â–ªï¸ /etc/nginx/sites-enabled/ : NGINXê°€ ì‹¤ì œë¡œ ì½ì–´ë“¤ì´ëŠ” í™œì„± ì„¤ì • <br />
â–ªï¸ ì¥ì : í”„ë¡œì íŠ¸ë³„ë¡œ ì„¤ì •ì„ ë§Œë“¤ì–´ë‘ê³  í•„ìš”í•  ë•Œë§Œ ì‹¬ë³¼ë¦­ ë§í¬ë¡œ í•„ìš”í•  ë•Œë§Œ on/off ê°€ëŠ¥</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo ln</span> <span class="nt">-s</span> /etc/nginx/sites-available/[í”„ë¡œì íŠ¸ ì´ë¦„] /etc/nginx/sites-enabled/[í”„ë¡œì íŠ¸ ì´ë¦„]
</code></pre></div></div>
<p><br /></p>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="NestJS" /><category term="NestJS" /><category term="NGINX" /><category term="PM2" /><category term="EC2" /><category term="AWS" /><summary type="html"><![CDATA[ëŒ€ì²´ ì™œ ë°±ì—”ë“œ ì„œë²„ì—ì„œ ìš”ì²­ì€ ìˆ˜í–‰í•˜ëŠ”ë°, ë¸Œë¼ìš°ì €ëŠ” CORS ì—ëŸ¬ë¥¼ ë³´ì—¬ì£¼ëŠ”ê±°ì•¼!]]></summary></entry><entry><title type="html">[NestJS] NestJSì—ì„œ Socket.IO ì—°ê²° ì‹œ 404 ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ì´ìœ </title><link href="http://localhost:4000/nestjs/nestjs-NestJS%EC%97%90%EC%84%9C-Socket.IO-%EC%97%B0%EA%B2%B0-%EC%8B%9C-404-%EC%97%90%EB%9F%AC%EA%B0%80-%EB%B0%9C%EC%83%9D%ED%95%9C-%EC%9D%B4%EC%9C%A0/" rel="alternate" type="text/html" title="[NestJS] NestJSì—ì„œ Socket.IO ì—°ê²° ì‹œ 404 ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ì´ìœ " /><published>2025-04-21T00:00:00+09:00</published><updated>2025-04-21T22:06:00+09:00</updated><id>http://localhost:4000/nestjs/nestjs-NestJS%EC%97%90%EC%84%9C%20Socket.IO%20%EC%97%B0%EA%B2%B0%20%EC%8B%9C%20404%20%EC%97%90%EB%9F%AC%EA%B0%80%20%EB%B0%9C%EC%83%9D%ED%95%9C%20%EC%9D%B4%EC%9C%A0</id><content type="html" xml:base="http://localhost:4000/nestjs/nestjs-NestJS%EC%97%90%EC%84%9C-Socket.IO-%EC%97%B0%EA%B2%B0-%EC%8B%9C-404-%EC%97%90%EB%9F%AC%EA%B0%80-%EB%B0%9C%EC%83%9D%ED%95%9C-%EC%9D%B4%EC%9C%A0/"><![CDATA[<h2 id="ï¸ë¬¸ì œ-ìƒí™©">â—¾ï¸ë¬¸ì œ ìƒí™©</h2>

<p><a href="https://github.com/SJ0826/rebook-api">rebook í”„ë¡œì íŠ¸</a>ì—ì„œ NestJS + Socket.IOë¡œ ì‹¤ì‹œê°„ ì±„íŒ…ì„ êµ¬í˜„í•˜ë ¤ë˜ ë„ì¤‘, <br />í´ë¼ì´ì–¸íŠ¸ì—ì„œ WebSocket ì—°ê²°ì´ ì•ˆë˜ê³  ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET <span class="o">{</span>SERVER_URL<span class="o">}</span>/socket.io/?EIO<span class="o">=</span>4&amp;transport<span class="o">=</span>polling 404 <span class="o">(</span>Not Found<span class="o">)</span>
</code></pre></div></div>
<p><br />
WebSocket ì—°ê²° ì „ polling ìš”ì²­ì´ 404ë¡œ ì‹¤íŒ¨í•˜ë©´ì„œ ì›¹ì†Œì¼“ ì—°ê²° ìì²´ê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>

<h2 id="-ë¬¸ì œ-ì›ì¸">â—¾ ë¬¸ì œ ì›ì¸</h2>

<p>404ì—ëŸ¬ ì´ê¸¸ë˜ ì²˜ìŒì—ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë° ê²½ë¡œ ì„¤ì • ë¬¸ì œì¸ ì¤„ ì•Œì•˜ìŠµë‹ˆë‹¤.</p>

<p>Socket.IOëŠ” ë‚´ë¶€ì ìœ¼ë¡œ <strong>HTTP í•¸ë“œì…°ì´í¬ë¥¼ ìœ„í•´ /socket.io ê²½ë¡œì— polling ìš”ì²­</strong>ì„ ë¨¼ì € ë³´ëƒ…ë‹ˆë‹¤.</p>

<p>í•˜ì§€ë§Œ NestJSëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì´ ê²½ë¡œë¥¼ ì¸ì‹í•˜ì§€ ì•Šìœ¼ë©° IoAdapterì„ í†µí•´ Socket.IOë¥¼ Express ì„œë²„ì— ë¶™ì—¬ì¤˜ì•¼ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.</p>

<p><strong>ğŸ’¾ ws.adapter.ts</strong></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SocketIoAdapter</span> <span class="kd">extends</span> <span class="nx">IoAdapter</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">app</span><span class="p">:</span> <span class="nx">INestApplication</span><span class="p">,</span> <span class="c1">// NestApplication ê°ì²´</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">ConfigService</span><span class="p">,</span> <span class="c1">// ConfigService</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">();</span> <span class="c1">// âš ï¸ HTTP ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ superì— ì „ë‹¬í•˜ì§€ ì•Šì•˜ìŒ</span>
  <span class="p">}</span>

  <span class="nx">createIOServer</span><span class="p">(</span><span class="nx">portOrServer</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">options</span><span class="p">?:</span> <span class="nx">ServerOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">serverArg</span> <span class="o">=</span>
      <span class="k">typeof</span> <span class="nx">portOrServer</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">portOrServer</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">partialOpts</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">ServerOptions</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">cors</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">origin</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">CLIENT_URL</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">serverArg</span>
      <span class="p">?</span> <span class="k">super</span><span class="p">.</span><span class="nx">createIOServer</span><span class="p">(</span><span class="nx">serverArg</span><span class="p">,</span> <span class="nx">partialOpts</span> <span class="k">as</span> <span class="nx">ServerOptions</span><span class="p">)</span>
      <span class="p">:</span> <span class="k">super</span><span class="p">.</span><span class="nx">createIOServer</span><span class="p">(</span><span class="nx">portOrServer</span><span class="p">,</span> <span class="nx">partialOpts</span> <span class="k">as</span> <span class="nx">ServerOptions</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<ul>
  <li>ë¬¸ì œ: SocketIoAdapterì—ì„œ super()ë§Œ í˜¸ì¶œí•˜ê³  httpServerë¥¼ ë„˜ê¸°ì§€ ì•ŠìŒ</li>
  <li>ê²°ê³¼: /socket.io í•¸ë“¤ëŸ¬ê°€ Expressì— ë“±ë¡ë˜ì§€ ì•Šì•„ polling ìš”ì²­ì‹œ 404ì—ëŸ¬ê°€ ë°œìƒí•¨</li>
</ul>

<p><br /></p>

<h2 id="ï¸-í•´ê²°-ë°©ë²•">â—¾ï¸ í•´ê²° ë°©ë²•</h2>

<h3 id="1-ì–´ëŒ‘í„°ì—-httpserver-ì „ë‹¬">1. ì–´ëŒ‘í„°ì— httpServer ì „ë‹¬</h3>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SocketIoAdapter</span> <span class="kd">extends</span> <span class="nx">IoAdapter</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">app</span><span class="p">:</span> <span class="nx">INestApplication</span><span class="p">,</span> <span class="c1">// NestApplication ê°ì²´</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">ConfigService</span><span class="p">,</span> <span class="c1">// ConfigService</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">getHttpServer</span><span class="p">());</span> <span class="c1">// âœ…ï¸ HTTP ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ superì— ì „ë‹¬</span>
  <span class="p">}</span>

  <span class="nx">createIOServer</span><span class="p">(</span><span class="nx">portOrServer</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">options</span><span class="p">?:</span> <span class="nx">ServerOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">serverArg</span> <span class="o">=</span>
      <span class="k">typeof</span> <span class="nx">portOrServer</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">portOrServer</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">partialOpts</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">ServerOptions</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">cors</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">origin</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">CLIENT_URL</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">serverArg</span>
      <span class="p">?</span> <span class="k">super</span><span class="p">.</span><span class="nx">createIOServer</span><span class="p">(</span><span class="nx">serverArg</span><span class="p">,</span> <span class="nx">partialOpts</span> <span class="k">as</span> <span class="nx">ServerOptions</span><span class="p">)</span>
      <span class="p">:</span> <span class="k">super</span><span class="p">.</span><span class="nx">createIOServer</span><span class="p">(</span><span class="nx">portOrServer</span><span class="p">,</span> <span class="nx">partialOpts</span> <span class="k">as</span> <span class="nx">ServerOptions</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h3 id="2-maintsì—-ì–´ëŒ‘í„°-ë“±ë¡">2. main.tsì— ì–´ëŒ‘í„° ë“±ë¡</h3>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">bootstrap</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NestFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">AppModule</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">ConfigService</span><span class="p">);</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">enableCors</span><span class="p">({</span>
    <span class="na">origin</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">CLIENT_URL</span><span class="dl">'</span><span class="p">),</span>
    <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">useWebSocketAdapter</span><span class="p">(</span><span class="k">new</span> <span class="nx">SocketIoAdapter</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">configService</span><span class="p">));</span>

  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>httpServerì„ ì œëŒ€ë¡œ ì „ë‹¬í•´ì£¼ê³ ë‚˜ì polling -&gt; WebSocket ìˆœìœ¼ë¡œ ìš”ì²­ì´ ì„±ê³µí–ˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="ï¸-polling---websocket-í•¸ë“œ-ì…°ì´í¬-êµ¬ì¡°">ğŸ“–ï¸ polling -&gt; WebSocket í•¸ë“œ ì…°ì´í¬ êµ¬ì¡°</h2>

<h3 id="ï¸-polling---websocket-í•¸ë“œ-ì…°ì´í¬ë€-">â†”ï¸ polling -&gt; WebSocket í•¸ë“œ ì…°ì´í¬ë€ ?</h3>
<ul>
  <li>Socket.IO ì—°ê²° êµ¬ì¡°ì˜ í•µì‹¬ ê°œë…</li>
  <li>WebSocket ì—°ê²°ì „ ì„œë²„ì™€ ë¨¼ì € HTTPë¡œ ì—°ê²°í•˜ê³ , ê·¸ ë‹¤ìŒ Websocketìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ í•˜ëŠ” ê³¼ì •</li>
</ul>

<p><strong>ğŸ“Œ Socket.IOì˜ ì—°ê²° ê³¼ì •</strong></p>
<ol>
  <li>í´ë¼ì´ì–¸íŠ¸ê°€ ë¨¼ì € polling ë°©ì‹ìœ¼ë¡œ ì„œë²„ì— ì—°ê²° ì‹œë„</li>
  <li>ì„œë²„ê°€ ì‘ë‹µí•˜ê³ , í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°€ ì„œë¡œ ì—°ê²° í™•ì¸</li>
  <li>ì—°ê²°ì´ í™•ì¸ë˜ë©´, HTTPì—°ê²°ì„ Websocketìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ</li>
</ol>

<p><strong>ğŸ“Œ Socket.IOê°€ í•¸ë“œì…°ì´í¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ </strong></p>
<ul>
  <li>Websocketì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë„¤íŠ¸ì›Œí¬/ë¸Œë¼ìš°ì € í™˜ê²½ì´ ì•„ì§ ì¡´ì¬</li>
  <li>ìµœì´ˆì—°ê²°ì€ HTTPë¡œ ì‹œì‘í•´ì„œ WebSocket ì—°ê²° ê°€ëŠ¥ì„±ì„ íŒë‹¨</li>
</ul>

<h2 id="ï¸ì „ì²´-ì½”ë“œ">â—¾ï¸ì „ì²´ ì½”ë“œ</h2>
<h3 id="ï¸-ì„œë²„ì¸¡-ì½”ë“œ-nestjs">â˜‘ï¸ ì„œë²„ì¸¡ ì½”ë“œ (NestJS)</h3>

<p><strong>ğŸ’¾ chat.gateway.ts</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">WebSocketGateway</span><span class="p">({</span>
  <span class="na">cors</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">origin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">{CLIENT_URL}</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">methods</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">GET</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">allowedHeaders</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Authorization</span><span class="dl">'</span><span class="p">],</span>
    <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="p">})</span>
</code></pre></div></div>
<p><br /></p>

<p><strong>ğŸ’¾ ws.adapter.ts</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">IoAdapter</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/platform-socket.io</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">INestApplication</span><span class="p">,</span> <span class="nx">Injectable</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/common</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ServerOptions</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">socket.io</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ConfigService</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nestjs/config</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// ws ì—°ê²° í”„ë¡ íŠ¸ ì„œë²„ ì£¼ì†Œë¥¼ ë™ì ìœ¼ë¡œ ì—°ê²°í•´ì¤€ë‹¤.(dev/prod êµ¬ë¶„)</span>
<span class="p">@</span><span class="nd">Injectable</span><span class="p">()</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">SocketIoAdapter</span> <span class="kd">extends</span> <span class="nx">IoAdapter</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">app</span><span class="p">:</span> <span class="nx">INestApplication</span><span class="p">,</span> <span class="c1">// NestApplication ê°ì²´</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="nx">config</span><span class="p">:</span> <span class="nx">ConfigService</span><span class="p">,</span> <span class="c1">// ConfigService</span>
  <span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">(</span><span class="nx">app</span><span class="p">.</span><span class="nx">getHttpServer</span><span class="p">());</span> <span class="c1">// âš ï¸ HTTP ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ superì— ì „ë‹¬</span>
  <span class="p">}</span>

  <span class="nx">createIOServer</span><span class="p">(</span><span class="nx">portOrServer</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">options</span><span class="p">?:</span> <span class="nx">ServerOptions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">serverArg</span> <span class="o">=</span>
      <span class="k">typeof</span> <span class="nx">portOrServer</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span> <span class="p">?</span> <span class="kc">undefined</span> <span class="p">:</span> <span class="nx">portOrServer</span><span class="p">;</span>

    <span class="kd">const</span> <span class="nx">partialOpts</span><span class="p">:</span> <span class="nb">Partial</span><span class="o">&lt;</span><span class="nx">ServerOptions</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">cors</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">origin</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">CLIENT_URL</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nx">serverArg</span>
      <span class="p">?</span> <span class="k">super</span><span class="p">.</span><span class="nx">createIOServer</span><span class="p">(</span><span class="nx">serverArg</span><span class="p">,</span> <span class="nx">partialOpts</span> <span class="k">as</span> <span class="nx">ServerOptions</span><span class="p">)</span>
      <span class="p">:</span> <span class="k">super</span><span class="p">.</span><span class="nx">createIOServer</span><span class="p">(</span><span class="nx">portOrServer</span><span class="p">,</span> <span class="nx">partialOpts</span> <span class="k">as</span> <span class="nx">ServerOptions</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><br /></p>

<p><strong>ğŸ’¾ main.ts</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nx">bootstrap</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">NestFactory</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">AppModule</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">ConfigService</span><span class="p">);</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">enableCors</span><span class="p">({</span>
    <span class="na">origin</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">CLIENT_URL</span><span class="dl">'</span><span class="p">),</span>
    <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">});</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">useWebSocketAdapter</span><span class="p">(</span><span class="k">new</span> <span class="nx">SocketIoAdapter</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">config</span><span class="p">));</span>

  <span class="k">await</span> <span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><br /></p>

<h3 id="ï¸-í´ë¼ì´ì–¸íŠ¸ì¸¡-ì½”ë“œ-nextjs">â˜‘ï¸ í´ë¼ì´ì–¸íŠ¸ì¸¡ ì½”ë“œ (NextJS)</h3>

<p><strong>ğŸ’¾ useChat.ts</strong></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useRef</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">io</span><span class="p">,</span> <span class="nx">Socket</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">socket.io-client</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">ChatMessage</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/types/chat</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">getChatMessages</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/lib/api/chat</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useAuth</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/hooks/useAuth</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">useChat</span><span class="p">(</span>
  <span class="nx">chatRoomId</span><span class="p">:</span> <span class="kr">number</span> <span class="o">|</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">onMessagesLoaded</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Dispatch</span><span class="o">&lt;</span><span class="nx">React</span><span class="p">.</span><span class="nx">SetStateAction</span><span class="o">&lt;</span><span class="nx">ChatMessage</span><span class="p">[]</span><span class="o">&gt;&gt;</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">accessToken</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">useAuth</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">socketRef</span> <span class="o">=</span> <span class="nx">useRef</span><span class="o">&lt;</span><span class="nx">Socket</span><span class="o">&gt;</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">chatRoomId</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="c1">// 1. ê¸°ì¡´ ë©”ì„¸ì§€ ì¡°íšŒ</span>
    <span class="kd">const</span> <span class="nx">loadMessages</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getChatMessages</span><span class="p">(</span><span class="nx">chatRoomId</span><span class="p">);</span>
        <span class="nx">onMessagesLoaded</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ë©”ì„¸ì§€ ì¡°íšŒ ì‹¤íŒ¨</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">// 2. ì†Œì¼“ ì—°ê²° ë° ë°© ì…ì¥</span>
    <span class="kd">const</span> <span class="nx">connectSocket</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ğŸ”„ ì†Œì¼“ ì—°ê²° ì‹œë„:</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">chatRoomId</span><span class="p">,</span> <span class="na">token</span><span class="p">:</span> <span class="o">!!</span><span class="nx">accessToken</span> <span class="p">});</span>

      <span class="nx">socketRef</span><span class="p">.</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://localhost:4000</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">transports</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">websocket</span><span class="dl">'</span><span class="p">],</span>
        <span class="na">withCredentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">auth</span><span class="p">:</span> <span class="p">{</span> <span class="na">token</span><span class="p">:</span> <span class="nx">accessToken</span> <span class="p">},</span>
      <span class="p">});</span>

      <span class="nx">socketRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">âœ… ì†Œì¼“ ì—°ê²° ì„±ê³µ!</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">socketRef</span><span class="p">.</span><span class="nx">current</span><span class="p">?.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">joinRoom</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span> <span class="nx">chatRoomId</span> <span class="p">});</span>
      <span class="p">});</span>

      <span class="nx">socketRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connect_error</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="dl">'</span><span class="s1">âŒ ì†Œì¼“ ì—°ê²° ì˜¤ë¥˜:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="c1">// ë©”ì„¸ì§€ ìˆ˜ì‹ </span>
      <span class="nx">socketRef</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">newMessage</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="na">message</span><span class="p">:</span> <span class="nx">ChatMessage</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ğŸ“© ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹ :</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
        <span class="nx">onMessagesLoaded</span><span class="p">((</span><span class="nx">prev</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[...</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">message</span><span class="p">]);</span>
      <span class="p">});</span>
    <span class="p">};</span>

    <span class="nx">loadMessages</span><span class="p">();</span>
    <span class="nx">connectSocket</span><span class="p">();</span>

    <span class="c1">// cleanup</span>
    <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">socketRef</span><span class="p">.</span><span class="nx">current</span><span class="p">?.</span><span class="nx">disconnect</span><span class="p">();</span>
    <span class="p">};</span>
  <span class="p">},</span> <span class="p">[</span><span class="nx">chatRoomId</span><span class="p">,</span> <span class="nx">onMessagesLoaded</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="NestJS" /><category term="NestJS" /><category term="Socket.io" /><category term="adapter" /><category term="rebook" /><summary type="html"><![CDATA[NestJSì—ì„œ Socket.IOì„ ì—°ê²°í•  ë•ŒëŠ” IoAdapterì„ í†µí•´ httpServerì„ ì „ë‹¬í•´ì£¼ì]]></summary></entry><entry><title type="html">[ë„¤íŠ¸ì›Œí¬] RefreshTokenì„ ì™œ ì¿ í‚¤ì— ì €ì¥í•´ì•¼í• ê¹Œ?</title><link href="http://localhost:4000/network/network-RefreshToken%EC%9D%84-%EC%99%9C-%EC%BF%A0%ED%82%A4%EC%97%90-%EC%A0%80%EC%9E%A5%ED%95%B4%EC%95%BC%ED%95%A0%EA%B9%8C/" rel="alternate" type="text/html" title="[ë„¤íŠ¸ì›Œí¬] RefreshTokenì„ ì™œ ì¿ í‚¤ì— ì €ì¥í•´ì•¼í• ê¹Œ?" /><published>2025-03-17T00:00:00+09:00</published><updated>2025-03-18T22:06:00+09:00</updated><id>http://localhost:4000/network/network-RefreshToken%EC%9D%84%20%EC%99%9C%20%EC%BF%A0%ED%82%A4%EC%97%90%20%EC%A0%80%EC%9E%A5%ED%95%B4%EC%95%BC%ED%95%A0%EA%B9%8C</id><content type="html" xml:base="http://localhost:4000/network/network-RefreshToken%EC%9D%84-%EC%99%9C-%EC%BF%A0%ED%82%A4%EC%97%90-%EC%A0%80%EC%9E%A5%ED%95%B4%EC%95%BC%ED%95%A0%EA%B9%8C/"><![CDATA[<h2 id="-accesstokenì€-ë©”ëª¨ë¦¬ì—-refreshtokenì€-ì¿ í‚¤ì—-ì €ì¥í•˜ê²Œ-ëœ-ì´ìœ ">ğŸª accessTokenì€ ë©”ëª¨ë¦¬ì—, refreshTokenì€ ì¿ í‚¤ì— ì €ì¥í•˜ê²Œ ëœ ì´ìœ </h2>
<p>ì—¬ëŸ¬ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ í•­ìƒ JWT í† í°ì„ ë‹¤ë¤„ì™”ìŠµë‹ˆë‹¤.
ê·¸ ê³¼ì •ì—ì„œ <strong>í† í° ê´€ë¦¬ ë°©ë²•</strong>ì´ ê¶ê¸ˆí•´ ì—¬ëŸ¬ ìë£Œë¥¼ ì°¾ì•„ë´¤ê³ , ê°€ì¥ ë§ì´ ì¶”ì²œë˜ëŠ” ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ì•˜ìŠµë‹ˆë‹¤.</p>

<p>âœ… <strong>Access Token</strong> â†’ í”„ë¡ íŠ¸ì—”ë“œì˜ ë©”ëª¨ë¦¬ì— ì €ì¥<br />
âœ… <strong>Refresh Token</strong> â†’ ë°±ì—”ë“œ ì„œë²„ì—ì„œ HttpOnly ì¿ í‚¤ë¡œ ê´€ë¦¬</p>

<p>ì´ë²ˆ Rebook í”„ë¡œì íŠ¸ì—ì„œëŠ” í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ê°œë°œì„ ëª¨ë‘ ë§¡ê³  ìˆê¸° ë•Œë¬¸ì—,
ê·¸ë™ì•ˆ ê¶ê¸ˆí–ˆë˜ ì´ í† í° ê´€ë¦¬ ë°©ì‹ì„ ì§ì ‘ ì‹¤í—˜í•´ë³¼ ì¢‹ì€ ê¸°íšŒê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<h2 id="-ë¦¬í”„ë ˆì‹œ-í† í°ì„-ì™œ-ì¿ í‚¤ì—-ì €ì¥í•´ì•¼í• ê¹Œ">ğŸª ë¦¬í”„ë ˆì‹œ í† í°ì„ ì™œ ì¿ í‚¤ì— ì €ì¥í•´ì•¼í• ê¹Œ?</h2>

<p>ë¦¬í”„ë ˆì‹œ í† í°ì„ ì¿ í‚¤ì— ì €ì¥í•œë‹¤ëŠ” ê²ƒì€ ì •í™•íˆ <strong>HttpOnly Secure ì¿ í‚¤</strong>ì— ì €ì¥í•œë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">setCookieOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">httpOnly</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// âœ… JavaScriptì—ì„œ ì ‘ê·¼ ë¶ˆê°€ëŠ¥ â†’ XSS ë°©ì–´</span>
  <span class="na">secure</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// âœ… HTTPSì—ì„œë§Œ ì „ì†¡</span>
  <span class="na">sameSite</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">lax</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// âœ… CORSì™€ ì¼ì¹˜í•´ì•¼ í•¨</span>
  <span class="na">maxAge</span><span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// âœ… 7ì¼ (ë°€ë¦¬ì´ˆ)</span>
  <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="1-xss-ê³µê²©-ë°©ì–´">1. XSS ê³µê²© ë°©ì–´</h3>

<h4 id="ï¸-xsscross-site-scripting-í¬ë¡œìŠ¤-ì‚¬ì´íŠ¸-ìŠ¤í¬ë¦½íŒ…ë€-">â—¾ï¸ XSS(Cross-Site Scripting-í¬ë¡œìŠ¤ ì‚¬ì´íŠ¸ ìŠ¤í¬ë¦½íŒ…)ë€ ?</h4>
<ul>
  <li>ê³µê²©ìê°€ ì›¹ì‚¬ì´íŠ¸ì— <strong>ì•…ì„± ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ì‚½ì…</strong></li>
  <li>ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ í†µí•´ ì‚¬ìš©ìì˜ ì¿ í‚¤ë‚˜ ê°œì¸ì •ë³´ë¥¼ íƒˆì·¨í•˜ê±°ë‚˜ ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰</li>
</ul>

<p>ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì¿ í‚¤ì— ì ‘ê·¼í•˜ë ¤ë©´ ë³´í†µ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">;</span> 
</code></pre></div></div>

<p>httpOnly ì„¤ì •ì€ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œê°€ ì¿ í‚¤ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.</p>

<p>ë¦¬í”„ë ˆì‹œ í† í°ì€ ì‚¬ìš©ê¸°ê°„ë„ ê¸¸ê³ , ê³„ì†í•´ì„œ ì—‘ì„¸ìŠ¤ í† í°ì„ ë°œê¸‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ë³´ì•ˆ ì¤‘ìš”ì„±ì„ ë†’ê²Œ ê°€ì ¸ê°€ê¸° ìœ„í•´ ì¿ í‚¤ì— ì €ì¥í•˜ëŠ” ë°©ì‹ì„ ë§ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h3 id="2-csrf-ê³µê²©-ë°©ì–´">2. CSRF ê³µê²© ë°©ì–´</h3>
<h4 id="ï¸csrfcross-site-request-forgery-ë€">â—¾ï¸CSRF(Cross-Site Request Forgery) ë€?</h4>
<ul>
  <li>ê³µê²©ìê°€ ì‚¬ìš©ìì˜ ì„¸ì…˜ì„ ì´ìš©í•´ <strong>ì•…ì˜ì ì¸ ìš”ì²­ì„ ìë™ìœ¼ë¡œ ë³´ë‚´ëŠ” ê³µê²©</strong></li>
  <li>ê³µê²©ìê°€ ì‚¬ìš©ìì˜ ì„¸ì…˜ì„ íƒˆì·¨í•´ ì„ì˜ì˜ ê¸°ê¸°ì—ì„œ ì›ì¹˜ì•Šì€ ìš”ì²­(êµ¬ë§¤, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë“±)ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.</li>
</ul>

<p>ì´ëŸ¬í•œ ê²½ìš°ëŠ” ì§ì ‘ ë¦¬í”„ë ˆì‹œí† í°ì„ ë³´ì§€ ì•Šê³ ë„ ì•…ì˜ì  ìš”ì²­ì„ ë³´ë‚´ëŠ” ê³µê²© ë°©ì‹ì…ë‹ˆë‹¤.</p>

<p>CSRF ê³µê²© ì‹œë‚˜ë¦¬ì˜¤ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<ol>
  <li>í”¼í•´ìê°€ ì¤‘ê³ ì±… ê±°ë˜ ì‚¬ì´íŠ¸ Rebookì— ë¡œê·¸ì¸í•œë‹¤.</li>
  <li>ë¸Œë¼ìš°ì €ëŠ” ë¦¬í”„ë ˆì‹œí† í°ì„ HttpOnly Secure ì¿ í‚¤ë¡œ ì €ì¥í•œë‹¤.</li>
  <li>í”¼í•´ìëŠ” ê³µê²©ìê°€ ë§Œë“  ì•…ì„± ì‚¬ì´íŠ¸ì— ë°©ë¬¸í•œë‹¤.</li>
  <li>ì•…ì„±ì‚¬ì´íŠ¸ê°€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ Rebook ì„œë²„ë¡œ ê°•ì œ ìš”ì²­ ğŸ§¨ì„ ë³´ë‚¸ë‹¤.</li>
  <li>í”¼í•´ìì˜ ë¸Œë¼ìš°ì €ëŠ” ìë™ìœ¼ë¡œ ë¡œê·¸ì¸ëœ ì„¸ì…˜ (ì¿ í‚¤ í¬í•¨)ê³¼ í•¨ê»˜ ìš”ì²­ì„ ë³´ë‚¸ë‹¤.</li>
  <li>ê²°ê³¼ì ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì˜ë„ì™€ ê´€ë ¨ì—†ëŠ” ìš”ì²­ (êµ¬ë§¤, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ë“±)ì„ ë³´ë‚¸ë‹¤.</li>
</ol>

<p>ìœ„ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ê³µê²©ìëŠ” ì§ì ‘ ë¦¬í”„ë ˆì‹œí† í°ì„ íƒˆì·¨í•˜ì§€ ì•Šì•˜ì§€ë§Œ, í”¼í•´ìì˜ ì„¸ì…˜ì„ ì•…ìš©í•©ë‹ˆë‹¤.</p>

<p>ì´ëŸ¬í•œ ê²½ìš°ë¥¼ ë§‰ìœ¼ë ¤ë©´, <strong>ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ìš”ì²­í•  ë•Œ ì¿ í‚¤ë¥¼ ìë™ìœ¼ë¡œ ì „ì†¡í•˜ì§€ ì•Šë„ë¡</strong> í•´ì•¼í•©ë‹ˆë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">res</span><span class="p">.</span><span class="nx">cookie</span><span class="p">(</span><span class="dl">'</span><span class="s1">refreshToken</span><span class="dl">'</span><span class="p">,</span> <span class="nx">refreshToken</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">httpOnly</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="na">secure</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">,</span> 
  <span class="na">sameSite</span><span class="p">:</span> <span class="dl">'</span><span class="s1">strict</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// âœ… CSRF ê³µê²© ë°©ì–´ (ë‹¤ë¥¸ ì‚¬ì´íŠ¸ì—ì„œ ìë™ ìš”ì²­ ì°¨ë‹¨)</span>
  <span class="na">maxAge</span><span class="p">:</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> 
  <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="3-í”„ë¡ íŠ¸ì—”ë“œì˜-ê°œë°œì ì¸-í¸ë¦¬í•¨---ì¿ í‚¤-ì €ì¥-ì‚­ì œì—-ê´€ì—¬í•˜ì§€-ì•ŠëŠ”ë‹¤">3. í”„ë¡ íŠ¸ì—”ë“œì˜ ê°œë°œì ì¸ í¸ë¦¬í•¨ - ì¿ í‚¤ ì €ì¥, ì‚­ì œì— ê´€ì—¬í•˜ì§€ ì•ŠëŠ”ë‹¤.</h3>

<p>ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë‚˜ ì„¸ì…˜ìŠ¤í† ë¦¬ì§€ì˜ ê²½ìš°ì—ëŠ”, í”„ë¡ íŠ¸ì—”ë“œê°€ ì§ì ‘ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ì‚­ì œí•˜ëŠ” ì½”ë“œê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">refreshToken</span><span class="dl">'</span><span class="p">,</span> <span class="nx">response</span><span class="p">.</span><span class="nx">refreshToken</span><span class="p">);</span>
</code></pre></div></div>

<p>ì¿ í‚¤ì— ì €ì¥ëœ ê°’ì„ ê´€ë¦¬í•˜ëŠ” ì£¼ì²´ëŠ” ë°±ì—”ë“œì…ë‹ˆë‹¤. 
ë°±ì—”ë“œ ì„œë²„ì—ì„œ ì¿ í‚¤ì— ë¦¬í”„ë ˆì‹œí† í°ì„ ì„¤ì •í•˜ë©´, í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìê°€ ë¦¬í”„ë ˆì‹œ í† í°ì„ ì €ì¥í•˜ëŠ” ì½”ë“œë¥¼ ì§ì ‘ ì‘ì„±í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">apiClient</span> <span class="o">=</span> <span class="nx">axios</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="na">baseURL</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">withCredentials</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// âœ… ì¿ í‚¤ ìë™ í¬í•¨</span>
<span class="p">});</span>
</code></pre></div></div>

<p>withCredentialsì„ trueë¡œ ì„¤ì •í•˜ë©´, Authorization í—¤ë”ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•  í•„ìš”ì—†ì´ ìë™ìœ¼ë¡œ ì¿ í‚¤ê°€ í¬í•¨ë©ë‹ˆë‹¤.</p>

<p>í•˜ì§€ë§Œ HttpOnly ì¿ í‚¤ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ì§ì ‘ í™•ì¸í•  ìˆ˜ ì—†ì–´ ì¶”ê°€ì ì¸ ìƒíƒœê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>

<p>íŠ¹íˆ ì—‘ì„¸ìŠ¤í† í°ì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ” ë°©ì‹ì€ ìƒˆë¡œê³ ì¹¨ì‹œ í† í°ì´ ìœ ì‹¤ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤.
ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•˜ë ¤ë©´ LoggedIn ìƒíƒœë¥¼ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•´ì„œ ê´€ë¦¬í•´ì•¼í•©ë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="ï¸ëŠë‚€ì ">ğŸªï¸ëŠë‚€ì </h2>
<p>ë¦¬í”„ë ˆì‹œí† í°ì„ ì¿ í‚¤ë¡œ ê´€ë¦¬í•˜ë©´ì„œ, ë³´ì•ˆì ìœ¼ë¡œ ê³ ë ¤í•´ì•¼ í•  ë‹¤ì–‘í•œ ì´ìŠˆë¥¼ ê³µë¶€í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
ì´ì „ì—ëŠ” ì¿ í‚¤ë¥¼ ì´ë¡ ìœ¼ë¡œë§Œ ê³µë¶€í•˜ì—¬ ì´í•´ê°€ ë˜ì§€ ì•Šì•˜ë˜ ë¶€ë¶„ë“¤ì´, ë°±ì—”ë“œ ì„œë²„ì—ì„œ ì§ì ‘ ì¿ í‚¤ë¥¼ ì„¤ì •í•˜ê³  ê´€ë¦¬í•˜ë©´ì„œ ë”ìš± ëª…í™•í•´ì¡ŒìŠµë‹ˆë‹¤. <br /></p>

<p>ì´ ë°©ë²•ì€ í¸ë¦¬í•¨ë³´ë‹¤ëŠ” ë³´ì•ˆì„±ì„ ìš°ì„ í•˜ëŠ” ë°©ì‹ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.
í”„ë¡ íŠ¸ì—”ë“œê³¼ ë°±ì—”ë“œ ëª¨ë‘ ì¶”ê°€ì ì¸ ì‘ì—…ì´ í•„ìš”í–ˆìœ¼ë©°, íŠ¹íˆ NextJSì—ì„œ ì—‘ì„¸ìŠ¤í† í°ì„ ì „ì—­ ìƒíƒœ(Zustand)ë¡œ ê´€ë¦¬í•˜ë©° ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€ê°€ ì¤‘ìš”í•œ ê³¼ì œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. <br /></p>

<p>êµ¬í˜„ê³¼ì •ì´ ë‹¤ì†Œ ë³µì¡í•´ì¡Œì§€ë§Œ, í”„ë¡œì íŠ¸ê°€ ì¶”êµ¬í•˜ëŠ” ìš°ì„  ë°©í–¥ì´ ë³´ì•ˆì„± ê°•í™”ë¼ë©´ ì €ëŠ” ì´ ë°©ë²•ì„ ì•ìœ¼ë¡œë„ ì‚¬ìš©í•  ì˜ˆì •ì…ë‹ˆë‹¤.</p>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="network" /><category term="ì¿ í‚¤" /><category term="HTTP" /><category term="accessToken" /><category term="refreshToken" /><category term="JWT" /><category term="NextJS" /><category term="NestJS" /><summary type="html"><![CDATA[rebook í”„ë¡œì íŠ¸ì—ì„œ accessTokenì€ ë©”ëª¨ë¦¬ë¡œ, refreshTokenì€ ì¿ í‚¤ë¡œ ê´€ë¦¬í•´ë³´ê³  ì“°ëŠ” í›„ê¸°]]></summary></entry><entry><title type="html">[NestJS] NestJSë¡œ ë°°ìš°ëŠ” ë°±ì—”ë“œ í”„ë¡œê·¸ë˜ë° ì™„ë… í›„ê¸°</title><link href="http://localhost:4000/nestjs/nestjs-NestJS%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%B0%B1%EC%97%94%EB%93%9C-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%8A%A4%ED%84%B0%EB%94%94-%EB%85%B8%ED%8A%B8/" rel="alternate" type="text/html" title="[NestJS] NestJSë¡œ ë°°ìš°ëŠ” ë°±ì—”ë“œ í”„ë¡œê·¸ë˜ë° ì™„ë… í›„ê¸°" /><published>2025-02-09T00:00:00+09:00</published><updated>2025-02-09T22:06:00+09:00</updated><id>http://localhost:4000/nestjs/nestjs-NestJS%EB%A1%9C%20%EB%B0%B0%EC%9A%B0%EB%8A%94%20%EB%B0%B1%EC%97%94%EB%93%9C%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%20%EC%8A%A4%ED%84%B0%EB%94%94%20%EB%85%B8%ED%8A%B8</id><content type="html" xml:base="http://localhost:4000/nestjs/nestjs-NestJS%EB%A1%9C-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%B0%B1%EC%97%94%EB%93%9C-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-%EC%8A%A4%ED%84%B0%EB%94%94-%EB%85%B8%ED%8A%B8/"><![CDATA[<p><img src="/assets/image/posts/nestjs-book.jpg" alt="img.png" /></p>

<h2 id="ï¸-ì±…ì„-ì™„ë…í•˜ê³ -ë‚˜ì„œ">â—¾ï¸ ì±…ì„ ì™„ë…í•˜ê³  ë‚˜ì„œ</h2>
<p><a href="https://polyester-archduke-ab6.notion.site/NestJS-NestJS-191f73e111b3809a8d32ffa142b53c2d?pvs=4">ğŸ“’ë…¸ì…˜ ìŠ¤í„°ë”” ë…¸íŠ¸</a></p>

<p><a href="https://github.com/SJ0826/nestjs-auth">ğŸ± ì‹¤ìŠµ í”„ë¡œì íŠ¸ Github</a></p>

<h3 id="-ì¶”ì²œ-ëŒ€ìƒ">ğŸ˜€ ì¶”ì²œ ëŒ€ìƒ</h3>
<ul>
  <li>ê³µì‹ë¬¸ì„œì½ëŠ”ê²Œ í˜ë“¤ë‹¤.</li>
  <li>Nestjsì˜ ê¸°ë³¸ í•µì‹¬ê°œë…ì„ í•œê¶Œìœ¼ë¡œ ì •ë¦¬í•˜ê³  ì‹¶ë‹¤.</li>
  <li>Typescript ë¬¸ë²•ì— ìµìˆ™í•˜ë‹¤.</li>
</ul>

<h3 id="-ë¹„ì¶”ì²œ-ëŒ€ìƒ">ğŸ¤¨ ë¹„ì¶”ì²œ ëŒ€ìƒ</h3>
<ul>
  <li>ê°œë°œì´ ì•„ì˜ˆ ì²˜ìŒì´ë‹¤.</li>
  <li>Typescriptë¥¼ ì „í˜€ ëª¨ë¥¸ë‹¤.</li>
  <li>Nestjsì˜ ì‹¬í™” ê°œë…ì„ ê³µë¶€í•˜ê³  ì‹¶ë‹¤.</li>
</ul>

<p>NestJSëŠ” ë¨¼ì € ê³µì‹ë¬¸ì„œë¡œ ì ‘í–ˆìŠµë‹ˆë‹¤.<br />
ê³µì‹ë¬¸ì„œê°€ ì›Œë‚™ ì˜ë˜ì–´ìˆëŠ”í„°ë¼ ê¸°ë³¸ê°œë…ì„ ìŒ“ê¸°ì—ëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ í•œê¸€ë¡œ ì •ë¦¬ëœ ë¬¸ì„œë¡œ ê°œë…ì„ ì½ê³ ì‹¶ì–´ ì±…ì„ ì°¾ì•„ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.<br />
ì±…ì˜ êµ¬ì¡°ëŠ” ê°œë… -&gt; í”„ë¡œì íŠ¸ ì ìš© -&gt; ì‹¬í™” ê°œë… ìˆœì„œë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.<br />
ê°€ì¥ ì¢‹ì•˜ë˜ ì ì€ ì±…ì„ ì™„ë…í•˜ë©´ ìœ ì € (ì¸ì¦) í”„ë¡œì íŠ¸ë¥¼ ì™„ì„±í•  ìˆ˜ ìˆì–´ ì„±ì·¨ê°ì„ ëŠë‚„ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.<br />
ë‹¤ë§Œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ë£¨ëŠ” ì±…ì´ ì•„ë‹ˆê¸°ì— ì–´ëŠì •ë„ ê°œë°œê²½í—˜ì´ ìˆì–´ì•¼ ì†ë„ê°ìˆê²Œ ì±…ì„ ì½ì„ ìˆ˜ ìˆì–´ ê°œë°œ ì…ë¬¸ìì—ê²ŒëŠ” ë‹¤ì†Œ ë²„ê±°ìš¸ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.</p>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="NestJS" /><category term="NestJS" /><category term="ê³µë¶€" /></entry><entry><title type="html">[NestJS] NestJSê°€ env íŒŒì¼ì„ ì½ì–´ì˜¤ì§€ ëª»í–ˆì„ ë•Œ</title><link href="http://localhost:4000/nestjs/nestjs-NestJS%EA%B0%80-env-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EC%9D%BD%EC%96%B4%EC%98%A4%EC%A7%80-%EB%AA%BB%ED%96%88%EC%9D%84-%EB%95%8C/" rel="alternate" type="text/html" title="[NestJS] NestJSê°€ env íŒŒì¼ì„ ì½ì–´ì˜¤ì§€ ëª»í–ˆì„ ë•Œ" /><published>2025-02-08T00:00:00+09:00</published><updated>2025-02-08T22:06:00+09:00</updated><id>http://localhost:4000/nestjs/nestjs-NestJS%EA%B0%80%20env%20%ED%8C%8C%EC%9D%BC%EC%9D%84%20%EC%9D%BD%EC%96%B4%EC%98%A4%EC%A7%80%20%EB%AA%BB%ED%96%88%EC%9D%84%20%EB%95%8C</id><content type="html" xml:base="http://localhost:4000/nestjs/nestjs-NestJS%EA%B0%80-env-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EC%9D%BD%EC%96%B4%EC%98%A4%EC%A7%80-%EB%AA%BB%ED%96%88%EC%9D%84-%EB%95%8C/"><![CDATA[<h2 id="-ë¬¸ì œìƒí™©-í”„ë¡œì íŠ¸ê°€-env-íŒŒì¼ì—-ì ‘ê·¼ì„-í•˜ì§€-ëª»í•œë‹¤">ğŸª¹ ë¬¸ì œìƒí™©: í”„ë¡œì íŠ¸ê°€ env íŒŒì¼ì— ì ‘ê·¼ì„ í•˜ì§€ ëª»í•œë‹¤.</h2>

<p>ğŸ error message</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">ERROR</span> <span class="p">[</span><span class="nx">ExceptionHandler</span><span class="p">]</span> <span class="nb">Error</span><span class="p">:</span> <span class="nx">Config</span> <span class="nx">validation</span> <span class="nx">error</span><span class="p">:</span> <span class="dl">"</span><span class="s2">EMAIL_SERVICE</span><span class="dl">"</span> <span class="k">is</span> <span class="nx">required</span><span class="p">.</span> <span class="dl">"</span><span class="s2">EMAIL_AUTH_USER</span><span class="dl">"</span> <span class="k">is</span> <span class="nx">required</span><span class="p">.</span> <span class="dl">"</span><span class="s2">EMAIL_AUTH_PASSWORD</span><span class="dl">"</span> <span class="k">is</span> <span class="nx">required</span><span class="p">.</span> <span class="dl">"</span><span class="s2">EMAIL_BASE_URL</span><span class="dl">"</span> <span class="k">is</span> <span class="nx">required</span>
</code></pre></div></div>
<p><br /></p>

<p>ğŸ’¾ app.module.ts</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">@</span><span class="nd">Module</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span>
    <span class="nx">UsersModule</span><span class="p">,</span>
    <span class="nx">EmailModule</span><span class="p">,</span>
    <span class="nx">ConfigModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">({</span>
      <span class="na">envFilePath</span><span class="p">:</span> <span class="p">[</span><span class="s2">`</span><span class="p">${</span><span class="nx">__dirname</span><span class="p">}</span><span class="s2">/config/env/.</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">}</span><span class="s2">.env`</span><span class="p">],</span> 
      <span class="na">load</span><span class="p">:</span> <span class="p">[</span><span class="nx">emailConfig</span><span class="p">],</span>
      <span class="na">isGlobal</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ì „ì—­ëª¨ë“ˆë¡œ ì„¤ì •</span>
      <span class="nx">validationSchema</span><span class="p">,</span> <span class="c1">// joië¥¼ ì´ìš©í•´ ìœ íš¨ì„±ê²€ì‚¬</span>
    <span class="p">}),</span>
    <span class="nx">TypeOrmModule</span><span class="p">.</span><span class="nx">forRoot</span><span class="p">({</span>
      <span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">mysql</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">host</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DATABASE_HOST</span><span class="p">,</span>
      <span class="na">port</span><span class="p">:</span> <span class="mi">3306</span><span class="p">,</span>
      <span class="na">username</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DATABASE_USERNAME</span><span class="p">,</span>
      <span class="na">password</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DATABASE_PASSWORD</span><span class="p">,</span>
      <span class="na">database</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">entities</span><span class="p">:</span> <span class="p">[</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">/**/*.entity{.ts,.js}</span><span class="dl">'</span><span class="p">],</span> <span class="c1">// TypeORMì´ êµ¬ë™ë  ë•Œ ì¸ì‹í•˜ë„ë¡ í•  ì—”í‹°í‹° í´ë˜ìŠ¤ ê²½ë¡œ</span>
      <span class="na">synchronize</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">DATABASE_SYNCHRONIZE</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// dev | ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë  ë•Œ DBê°€ ì´ˆê¸°í™”ëœë‹¤.</span>
    <span class="p">}),</span>
  <span class="p">],</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">[],</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">})</span>
<span class="k">export</span> <span class="kd">class</span> <span class="nx">AppModule</span> <span class="p">{}</span>
</code></pre></div></div>

<p>nest-auth í”„ë¡œì íŠ¸ ì‹¤í–‰ ë„ì¤‘ í”„ë¡œì íŠ¸ê°€ envíŒŒì¼ì„ ì½ì–´ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">cat src/config/env/.development.env</code> â‡’ ì„±ê³µ <br />
<code class="language-plaintext highlighter-rouge">echo $NODE_ENV</code> â‡’ ì„±ê³µ (development)</p>

<p>í„°ë¯¸ë„ì„ í†µí•´ envíŒŒì¼ì„ ì½ëŠ” ê²ƒì€ ì„±ê³µí–ˆì§€ë§Œ ConfigModuleì—ì„œ envíŒŒì¼ì— ì ‘ê·¼ì„ í•˜ì§€ ëª»í•´ ê²½ë¡œë¬¸ì œì¼ ê²ƒì´ë¼ íŒë‹¨í–ˆìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="-ë¬¸ì œ-ì´ìœ -env-íŒŒì¼-ê²½ë¡œ-ë¬¸ì œ">ğŸª¹ ë¬¸ì œ ì´ìœ : .env íŒŒì¼ ê²½ë¡œ ë¬¸ì œ</h2>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">envFilePath</span><span class="p">:</span> <span class="p">[</span><span class="s2">`</span><span class="p">${</span><span class="nx">__dirname</span><span class="p">}</span><span class="s2">/config/env/.</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">}</span><span class="s2">.env`</span><span class="p">]</span>
</code></pre></div></div>
<p><strong>ts-node</strong>ë¥¼ ì‚¬ìš©í•  ê²½ìš° <strong>__dirname</strong>ì€ ê°ê° ë‹¤ìŒê³¼ ê°™ì€ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤.</p>

<ul>
  <li>ë¹Œë“œ ì „: src í´ë”</li>
  <li>ë¹Œë“œ í›„: dist í´ë”</li>
</ul>

<p>ë¹Œë“œ í›„ srcí´ë”ì¼ ê²ƒì´ë¼ëŠ” ì˜ˆìƒê³¼ ë‹¬ë¦¬  <strong>__dirname</strong>ê°€ dist í´ë”ë¥¼ ê°€ë¦¬í‚¤ê²Œ ë˜ì–´ envíŒŒì¼ì„ ì°¾ì§€ ëª»í•˜ê³  ì—ëŸ¬ê°€ ë°œìƒí•œ ê²ƒì…ë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="-ë¬¸ì œ-í•´ê²°-envfilepath-ê²½ë¡œ-ì¬ì„¤ì •">ğŸªº ë¬¸ì œ í•´ê²°: envFilePath ê²½ë¡œ ì¬ì„¤ì •</h2>
<p>envFilePath ê²½ë¡œë¥¼ ì¬ì„¤ì •í•´ í˜„ì¬ ì‘ì—… ë””ë ‰í† ë¦¬(process.cwd())ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê²½ë¡œë¥¼ ì§€ì •í•˜ê² ìŠµë‹ˆë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">envFilePath</span><span class="p">:</span> <span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="s2">`src/config/env/.</span><span class="p">${</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">}</span><span class="s2">.env`</span><span class="p">)]</span>
</code></pre></div></div>

<p>ë¬¸ì œì—†ì´ í”„ë¡œì íŠ¸ê°€ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/image/posts/nextjs-env-bug.png" alt="image" /></p>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="NestJS" /><category term="NestJS" /><category term="env" /><category term="error" /><summary type="html"><![CDATA[ë¹Œë“œ ì „ envFilePath ê²½ë¡œì™€ ë¹Œë“œ í›„ envFilePath ê²½ë¡œê°€ ë‹¬ë¼ìš”]]></summary></entry><entry><title type="html">[Next.js 14] npm íŒ¨í‚¤ì§€ ë°°í¬ ê°€ì´ë“œ</title><link href="http://localhost:4000/nextjs/nextjs-npm-%ED%8C%A8%ED%82%A4%EC%A7%80-%EB%B0%B0%ED%8F%AC-%EA%B0%80%EC%9D%B4%EB%93%9C/" rel="alternate" type="text/html" title="[Next.js 14] npm íŒ¨í‚¤ì§€ ë°°í¬ ê°€ì´ë“œ" /><published>2024-11-25T00:00:00+09:00</published><updated>2024-07-10T22:06:00+09:00</updated><id>http://localhost:4000/nextjs/nextjs-npm%20%ED%8C%A8%ED%82%A4%EC%A7%80%20%EB%B0%B0%ED%8F%AC%20%EA%B0%80%EC%9D%B4%EB%93%9C</id><content type="html" xml:base="http://localhost:4000/nextjs/nextjs-npm-%ED%8C%A8%ED%82%A4%EC%A7%80-%EB%B0%B0%ED%8F%AC-%EA%B0%80%EC%9D%B4%EB%93%9C/"><![CDATA[<h2 id="-ëª©ì ">â–  ëª©ì </h2>
<ul>
  <li>ì–´ë“œë¯¼ ë””ìì¸ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ì™€ ì—ì…‹ì„ íŒ¨í‚¤ì§€ë¡œ ë°°í¬í•´ ê´€ë¦¬</li>
  <li>ì•„í† ë¯¹ ë””ìì¸ íŒ¨í„´ì„ ì‚¬ìš©í•´ ì»´í¬ë„ŒíŠ¸ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ì„¤ê³„ ë° ê°œë°œ</li>
  <li>ì»´í¬ë„ŒíŠ¸ ìœ ì§€ë³´ìˆ˜ì„±ì„ ë†’ì´ê³ , ì¼ê´€ëœ UI/UXë¥¼ ì œê³µí•˜ë©°, ê°œë°œ ì†ë„ë¥¼ í–¥ìƒ</li>
</ul>

<h2 id="-í”„ë¡œì íŠ¸-í™˜ê²½">â–  í”„ë¡œì íŠ¸ í™˜ê²½</h2>
<ul>
  <li>next.js 14</li>
  <li>react 18</li>
  <li>tailwindcss 3.4.1</li>
</ul>

<h2 id="-ë°°í¬-ìˆœì„œ">â–  ë°°í¬ ìˆœì„œ</h2>

<h3 id="1-srcexportts-ë¥¼-ìƒì„±í•©ë‹ˆë‹¤">1. src/export.ts ë¥¼ ìƒì„±í•©ë‹ˆë‹¤</h3>

<p>íŒ¨í‚¤ì§€ë¡œ ë°°í¬í•  ì»´í¬ë„ŒíŠ¸ë¥¼ export.ts íŒŒì¼ì— ì„ ì–¸í•©ë‹ˆë‹¤. (íŒŒì¼ ê²½ë¡œì™€ ì´ë¦„ì€ ë³€ê²½ê°€ëŠ¥í•©ë‹ˆë‹¤)</p>

<p><strong>ğŸ’¾ src/export.ts</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="p">{</span><span class="k">default</span> <span class="k">as</span> <span class="nx">SujinButton</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./app/components/common/Button</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="2-tsconfigbuildjson-ì„-ìƒì„±í•©ë‹ˆë‹¤">2. tsconfig.build.json ì„ ìƒì„±í•©ë‹ˆë‹¤.</h3>

<ul>
  <li>(ê¸°ì¡´) tsconfig.json: Next.js ì–´í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ë¹Œë“œìš©</li>
  <li>(ìƒì„±) tsconfig.build.json: íŒ¨í‚¤ì§€ ë°°í¬ ì½”ë“œ ë¹Œë“œìš©</li>
</ul>

<p><strong>ğŸ’¾ tsconfig.build.json</strong></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">compilerOptions</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">lib</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">dom</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">dom.iterable</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">esnext</span><span class="dl">"</span><span class="p">],</span> <span class="c1">// í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  JavaScript í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬</span>
    <span class="dl">"</span><span class="s2">target</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ESNext</span><span class="dl">"</span><span class="p">,</span>  <span class="c1">// ì»´íŒŒì¼ ëŒ€ìƒ ECMAScript ë²„ì „</span>
    <span class="dl">"</span><span class="s2">allowJs</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// JavaScript íŒŒì¼ì„ TypeScript ì½”ë“œë¡œ í¬í•¨í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©</span>
    <span class="dl">"</span><span class="s2">skipLibCheck</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ íƒ€ì… ê²€ì‚¬ ê±´ë„ˆë›°ê¸°</span>
    <span class="dl">"</span><span class="s2">strict</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>  <span class="c1">// ì—„ê²© ëª¨ë“œ í™œì„±í™”</span>
    <span class="dl">"</span><span class="s2">noEmit</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// ì»´íŒŒì¼ëœ ì¶œë ¥ íŒŒì¼ ìƒì„± ì—¬ë¶€</span>
    <span class="dl">"</span><span class="s2">allowSyntheticDefaultImports</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ê¸°ë³¸(default) ë‚´ë³´ë‚´ê¸°ë¥¼ í—ˆìš©í• ì§€ ì—¬ë¶€</span>
    <span class="dl">"</span><span class="s2">esModuleInterop</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// CommonJS(require)ì™€ ES Module(import) ê°„ì˜ í˜¸í™˜ì„± ì„¤ì •</span>
    <span class="dl">"</span><span class="s2">forceConsistentCasingInFileNames</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// íŒŒì¼ ì´ë¦„ ëŒ€ì†Œë¬¸ì ë¶ˆì¼ì¹˜ë¥¼ ë°©ì§€</span>
    <span class="dl">"</span><span class="s2">noFallthroughCasesInSwitch</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// switch ë¬¸ì—ì„œ caseê°€ ëˆ„ë½ë˜ì§€ ì•Šë„ë¡ ë°©ì§€</span>
    <span class="dl">"</span><span class="s2">module</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">esnext</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ì‚¬ìš©í•  ëª¨ë“ˆ ì‹œìŠ¤í…œ</span>
    <span class="dl">"</span><span class="s2">moduleResolution</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">node</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ëª¨ë“ˆ í•´ì„ ë°©ì‹ì„ ì •ì˜</span>
    <span class="dl">"</span><span class="s2">resolveJsonModule</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// JSON íŒŒì¼ì„ ëª¨ë“ˆë¡œ ê°€ì ¸ì˜¤ê¸° í—ˆìš©</span>
    <span class="dl">"</span><span class="s2">isolatedModules</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ê°œë³„ íŒŒì¼ì„ ë…ë¦½ì ìœ¼ë¡œ ì»´íŒŒì¼</span>
    <span class="dl">"</span><span class="s2">jsx</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">react-jsx</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// React JSX êµ¬ë¬¸ ì„¤ì • - React 17+ì˜ ìƒˆë¡œìš´ JSX ë³€í™˜ ë°©ì‹ ì‚¬ìš©</span>
    <span class="dl">"</span><span class="s2">incremental</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// TypeScript ì´ì „ ë¹Œë“œ ê²°ê³¼ë¥¼ ì¬ì‚¬ìš©í•˜ì—¬ ë¹Œë“œ ì†ë„ í–¥ìƒ(ì¦ë¶„ ë¹Œë“œ)</span>
    <span class="dl">"</span><span class="s2">outDir</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dist</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// ì»´íŒŒì¼ëœ íŒŒì¼ì˜ ì¶œë ¥ ë””ë ‰í† ë¦¬</span>
    <span class="dl">"</span><span class="s2">declaration</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// íƒ€ì… ì •ì˜ íŒŒì¼ ìƒì„± ì—¬ë¶€ (.d.ts)</span>
    <span class="dl">"</span><span class="s2">plugins</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next</span><span class="dl">"</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="dl">"</span><span class="s2">paths</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">"</span><span class="s2">@/*</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">./src/*</span><span class="dl">"</span><span class="p">]</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">include</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span> <span class="dl">"</span><span class="s2">**/tailwind.config.ts</span><span class="dl">"</span><span class="p">,</span>  <span class="dl">"</span><span class="s2">src/export.ts</span><span class="dl">"</span><span class="p">],</span>
  <span class="dl">"</span><span class="s2">exclude</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">node_modules</span><span class="dl">"</span><span class="p">]</span>
<span class="p">}</span>

</code></pre></div></div>
<ul>
  <li>include
    <ul>
      <li><code class="language-plaintext highlighter-rouge">**/tailwind.config.ts</code> : tailwind ì„¤ì • (asset, font) ê³µìœ </li>
      <li><code class="language-plaintext highlighter-rouge">src/export.ts</code> : ì»´í¬ë„ŒíŠ¸ ê³µìœ </li>
    </ul>
  </li>
</ul>

<h3 id="3-packagejsonì„-ìˆ˜ì •í•©ë‹ˆë‹¤">3. package.jsonì„ ìˆ˜ì •í•©ë‹ˆë‹¤.</h3>

<p><strong>ğŸ’¾ package.json</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">sujin-design-system</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">version</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.1.5</span><span class="dl">"</span><span class="p">,</span> <span class="c1">// íŒ¨í‚¤ì§€ë¥¼ ìƒˆë¡œ ë°°í¬í•  ë•Œë§ˆë‹¤ ë²„ì „ì„ ì—…ê·¸ë ˆì´ë“œ í•´ì•¼í•©ë‹ˆë‹¤.</span>
  <span class="dl">"</span><span class="s2">main</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dist/src/export.js</span><span class="dl">"</span><span class="p">,</span> 
  <span class="dl">"</span><span class="s2">types</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dist/src/export.d.ts</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">files</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
    <span class="dl">"</span><span class="s2">dist</span><span class="dl">"</span>
  <span class="p">],</span>
  <span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">dev</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next dev</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">next:build</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next build</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next start</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">lint</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next lint</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">build</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">rm -rf dist &amp;&amp; tsc -p tsconfig.build.json</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">prepublishOnly</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">npm run build</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">dependencies</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^18</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">react-dom</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^18</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">next</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">14.2.18</span><span class="dl">"</span>
  <span class="p">},</span>
  <span class="dl">"</span><span class="s2">devDependencies</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">typescript</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^5</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">@types/node</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^20</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">@types/react</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^18</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">@types/react-dom</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^18</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">postcss</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">tailwindcss</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^3.4.1</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">eslint</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">^8</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">eslint-config-next</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">14.2.18</span><span class="dl">"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">main</code>: íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œ í›„ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•  ë•Œ ì§„ì…ì . ê°€ì¥ ë¨¼ì € ë¡œë“œë˜ëŠ” íŒŒì¼ì„ ì§€ì •.</li>
  <li><code class="language-plaintext highlighter-rouge">types</code> : íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íƒ€ì… ì •ì˜ íŒŒì¼</li>
</ul>

<p>package.jsonì„ ìˆ˜ì •í•˜ê³  npm run build ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ distí´ë”ê°€ ìƒì„±ë©ë‹ˆë‹¤.</p>

<p><img src="/assets/image/posts/nextjs-npm-deploy.png" alt="image" /></p>

<h3 id="4-npmì—-íŒ¨í‚¤ì§€-ë°°í¬í•˜ê¸°">4. npmì— íŒ¨í‚¤ì§€ ë°°í¬í•˜ê¸°</h3>

<ol>
  <li><code class="language-plaintext highlighter-rouge">npm login</code> : ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  ë¸Œë¼ìš°ì €ì—ì„œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">npm build</code> : íŒ¨í‚¤ì§€ì— í•„ìš”í•œ ë¹Œë“œíŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.</li>
  <li><code class="language-plaintext highlighter-rouge">npm publish</code> : ìƒì„±í•œ ë¹Œë“œ íŒŒì¼ì„ npmì— ë°°í¬í•©ë‹ˆë‹¤.</li>
</ol>

<p>ë°°í¬ì— ì„±ê³µí•˜ë©´ <a href="https://www.npmjs.com/">npm</a>ì—ì„œ ë°°í¬í•œ íŒ¨í‚¤ì§€ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><img src="/assets/image/posts/nextjs-npm-deploy-2.png" alt="image" /></p>

<h3 id="5-ë°°í¬í•œ-íŒ¨í‚¤ì§€-ì‚¬ìš©í•˜ê¸°">5. ë°°í¬í•œ íŒ¨í‚¤ì§€ ì‚¬ìš©í•˜ê¸°</h3>

<p>ë¨¼ì € ë°°í¬í•œ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•  í”„ë¡œì íŠ¸ì—ì„œ íŒ¨í‚¤ì§€ë¥¼ ë‹¤ìš´ë°›ìŠµë‹ˆë‹¤.</p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">npm</span> <span class="nx">i</span> <span class="nx">sujin</span><span class="o">-</span><span class="nx">design</span><span class="o">-</span><span class="nx">system</span>
</code></pre></div></div>

<p>tailwind.config.ts íŒŒì¼ì—ì„œ íŒ¨í‚¤ì§€ë¥¼ presetsì— ì ìš©í•©ë‹ˆë‹¤.</p>

<p><strong>ğŸ’¾ tailwind.config.ts</strong></p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">sujin</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">sujin-design-system/dist/tailwind.config</span><span class="dl">'</span><span class="p">;</span>

<span class="kr">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">presets</span><span class="p">:</span> <span class="p">[</span><span class="nx">sujin</span><span class="p">],</span> <span class="c1">// âœ… presetìœ¼ë¡œ íŒ¨í‚¤ì§€ì˜ tailwind ì„¤ì • ì ìš©</span>
  <span class="na">content</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">./src/**/*.{js,jsx,ts,tsx}</span><span class="dl">'</span><span class="p">],</span>

</code></pre></div></div>

<p>ì„¤ì •ì„ ì™„ë£Œí•˜ë©´ íŒ¨í‚¤ì§€ì˜ ì—ì…‹ê³¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">SujinButton</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">sujin-design-system</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// ğŸ‘</span>
</code></pre></div></div>
<h2 id="ì°¸ê³ ">ì°¸ê³ </h2>
<ul>
  <li><a href="https://blacksheepcode.com/posts/publish_a_react_package_using_nextjs_as_a_base">blacksheepcode - publish_a_react_package_using_nextjs_as_a_base</a></li>
</ul>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="Nextjs" /><category term="npm" /><category term="ë°°í¬" /><summary type="html"><![CDATA[ì»´í¬ë„ŒíŠ¸ë¥¼ íŒ¨í‚¤ì§€ë¡œ ë°°í¬í•´ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì— ê³µìœ í•˜ê¸°]]></summary></entry><entry><title type="html">[Next.js 13] í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ ì •ë§ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ ë Œë”ë§ ë ê¹Œ ?</title><link href="http://localhost:4000/nextjs/nextjs-Error-occured-prerendering-page/" rel="alternate" type="text/html" title="[Next.js 13] í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ê°€ ì •ë§ í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œë§Œ ë Œë”ë§ ë ê¹Œ ?" /><published>2024-07-10T00:00:00+09:00</published><updated>2024-07-10T22:06:00+09:00</updated><id>http://localhost:4000/nextjs/nextjs-Error%20occured%20prerendering%20page</id><content type="html" xml:base="http://localhost:4000/nextjs/nextjs-Error-occured-prerendering-page/"><![CDATA[<h2 id="ï¸ë¬¸ì œ-ë°œìƒ">â—¾ï¸ë¬¸ì œ ë°œìƒ</h2>

<p>react-draft-wysiwyg ë¥¼ ì‚¬ìš©í•œ ì»´í¬ë„ŒíŠ¸ë¥¼ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ì— importí–ˆìŠµë‹ˆë‹¤.
í˜ì´ì§€ëŠ” ì„±ê³µì ìœ¼ë¡œ ë Œë”ë§ ë˜ì—ˆì§€ë§Œ í„°ë¯¸ë„ì—ì„œ ì—ëŸ¬ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë¹Œë“œì‹œì—ë„ ë™ì¼í•œ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.</p>

<p><img src="/assets/image/posts/nextjs-prerendering-error.png" alt="image" /></p>

<p><code class="language-plaintext highlighter-rouge">use client</code>ë¥¼ ìµœìƒë‹¨ì— ì„ ì–¸í–ˆì—ˆê¸°ì—, í´ë¦¬ì´ì–¸íŠ¸ ì»´í¬ë„Œë¼ê³  ìƒê°í–ˆê³  ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‚  ë²•í•œ í”„ë¦¬ë Œë”ë§ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ ì´í•´ê°€ ê°€ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>

<h2 id="ï¸-ë¬¸ì œ-ì›ì¸">â—¾ï¸ ë¬¸ì œ ì›ì¸</h2>

<p>ë¬¸ì œê°€ ë°œìƒí•œ ì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<ul>
  <li>Next.js 13 ì»´í¬ë„ŒíŠ¸ëŠ” <strong>ì„œë²„ì—ì„œ ì‚¬ì „ ë Œë”ë§</strong>ë˜ê³  <strong>í´ë¼ì´ì–¸íŠ¸ì—ì„œ í•˜ì´ë“œë ˆì´ì…˜</strong>ëœë‹¤.</li>
  <li>ë”°ë¼ì„œ <code class="language-plaintext highlighter-rouge">use client</code> ë¥¼ ì„ ì–¸í•œë‹¤ê³ í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ë Œë”ë§ ë˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.</li>
</ul>

<p>ì»´í¬ë„ŒíŠ¸ì—ì„œ windowê°ì²´ì— ì ‘ê·¼í•˜ëŠ”ë°, ì„œë²„ì—ì„œ ì‚¬ì „ ë Œë”ë§ë˜ëŠ” ê³¼ì •ì—ì„œ windowê°ì²´ë¥¼ ì°¾ì§€ ëª»í•´ ì—ëŸ¬ê°€ ë°œìƒí•œ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.
í´ë¼ì´ì–¸íŠ¸ ë‹¨ì—ì„œë§Œ ì‹¤í–‰ë˜ì–´ì•¼í•˜ëŠ” ì½”ë“œëŠ” ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>

<h2 id="ï¸-ë¬¸ì œ-í•´ê²°">â—¾ï¸ ë¬¸ì œ í•´ê²°</h2>

<h3 id="ï¸-ë°©ë²•-1-dynamic-import-ë™ì -ì„í¬íŠ¸ë¡œ-ssr-ì˜µì…˜-ë„ê¸°">âœ”ï¸ ë°©ë²• 1. dynamic import (ë™ì  ì„í¬íŠ¸)ë¡œ SSR ì˜µì…˜ ë„ê¸°</h3>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">NoticeForm</span> <span class="o">=</span> <span class="nx">dynamic</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">import</span><span class="p">(</span><span class="dl">'</span><span class="s1">@/components/notice/NoticeForm</span><span class="dl">'</span><span class="p">),</span> <span class="p">{</span>
  <span class="na">ssr</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Next.js ì˜ <strong>dynamic import</strong> ê¸°ëŠ¥ì„ í™œìš©í•´ <strong>ì„œë²„ ì¸¡ ë Œë”ë§ì„ ë¹„í™œì„±í™”</strong>í–ˆìŠµë‹ˆë‹¤.
dynamic importëŠ” ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œ ì„ ì–¸í•´ì•¼í•©ë‹ˆë‹¤.</p>

<p>ë‹¤ë§Œ ì´ ë°©ë²•ì€ í•´ë‹¹ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ë™ì ìœ¼ë¡œ importí•´ì•¼í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆì—ˆê³ , ì—ëŸ¬ ì›ì¸ì„ ì°¾ë˜ ì¤‘ ì „ì—­ìœ¼ë¡œ ì„¤ì •í•´ì£¼ëŠ” ë°©ë²•ì´ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<h3 id="ï¸-ë°©ë²•-2-ì»¨í…ìŠ¤íŠ¸ë¥¼-ì‚¬ìš©í•œ-custom-hook-ë§Œë“¤ê¸°">âœ”ï¸ ë°©ë²• 2. ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•œ custom hook ë§Œë“¤ê¸°</h3>

<p>ë™ì  ì„í¬íŠ¸ ë§¤ì»¤ë‹ˆì¦˜ì„ ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ ë°˜ë³µì ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ëŒ€ì‹ , <strong>ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•´ ì „ì—­ì—ì„œ ê´€ë¦¬</strong>í•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.</p>

<p>useEffectì™€ useState í›…ì„ ì‚¬ìš©í•œ ì»¤ìŠ¤í…€ í›…ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ì„ ì‹¤í–‰ì¡°ê±´ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p>ì´ë ‡ê²Œí•˜ë©´ ì„œë²„ì—ì„œì˜ ì‚¬ì „ë Œë”ë§ê³¼ í´ë¼ì´ì–¸íŠ¸ì˜ ì²«ë²ˆì§¸ ë Œë”ë§ì´ ì¼ì¹˜í•´ í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜ë„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><strong>ğŸ’¾ useIsClient.tsx</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">'</span><span class="s1">use client</span><span class="dl">'</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span> <span class="nx">createContext</span><span class="p">,</span> <span class="nx">useContext</span><span class="p">,</span> <span class="nx">useEffect</span><span class="p">,</span> <span class="nx">useState</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">IsClientCtx</span> <span class="o">=</span> <span class="nx">createContext</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">IsClientCtxProvider</span> <span class="o">=</span> <span class="p">({</span>
  <span class="nx">children</span><span class="p">,</span>
<span class="p">}:</span> <span class="p">{</span>
  <span class="nl">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">[</span><span class="nx">isClient</span><span class="p">,</span> <span class="nx">setIsClient</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">setIsClient</span><span class="p">(</span><span class="kc">true</span><span class="p">),</span> <span class="p">[]);</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">IsClientCtx</span><span class="p">.</span><span class="nx">Provider</span> <span class="nx">value</span><span class="o">=</span><span class="p">{</span><span class="nx">isClient</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">children</span><span class="p">}</span><span class="o">&lt;</span><span class="sr">/IsClientCtx.Provider</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">};</span>

<span class="k">export</span> <span class="kd">function</span> <span class="nx">useIsClient</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">useContext</span><span class="p">(</span><span class="nx">IsClientCtx</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>ğŸ’¾ app/layout.tsx</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="kd">type</span> <span class="p">{</span> <span class="nx">Metadata</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">next</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">./globals.css</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IsClientCtxProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/hooks/useIsClient</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">metadata</span><span class="p">:</span> <span class="nx">Metadata</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">title</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Project</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Generated by create next app</span><span class="dl">'</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">RootLayout</span><span class="p">({</span>
  <span class="nx">children</span><span class="p">,</span>
<span class="p">}:</span> <span class="nb">Readonly</span><span class="o">&lt;</span><span class="p">{</span>
  <span class="na">children</span><span class="p">:</span> <span class="nx">React</span><span class="p">.</span><span class="nx">ReactNode</span><span class="p">;</span>
<span class="p">}</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">en</span><span class="dl">"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">IsClientCtxProvider</span><span class="o">&gt;</span>
					<span class="p">{</span><span class="nx">children</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/IsClientCtxProvider</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>ğŸ’¾ ì‚¬ìš©ì˜ˆì‹œ</strong></p>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useIsClient</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./is-client-ctx</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">MyComponent</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">isClient</span> <span class="o">=</span> <span class="nx">useIsClient</span><span class="p">();</span>
  <span class="kd">const</span> <span class="nx">scrollPosition</span> <span class="o">=</span> <span class="nx">useScrollPosition</span><span class="p">();</span> <span class="c1">// ì˜ˆì‹œë¥¼ ìœ„í•œ ê°€ìƒ í›…</span>

  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;&gt;</span>
      <span class="p">{</span><span class="nx">scrollPosition</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="nx">FirstModule</span> <span class="o">/&gt;</span><span class="p">}</span>
      <span class="p">{</span><span class="nx">isClient</span> <span class="o">&amp;&amp;</span> <span class="nx">scrollPosition</span> <span class="o">&gt;=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="o">&lt;</span><span class="nx">SecondModule</span> <span class="o">/&gt;</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="sr">/</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p>useIsClient.tsx í›…ì„ í†µí•´ ì„œë²„ì—ì„œ ë Œë”ë§í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ ë¨¼ì € ë Œë”ë§ í›„, í´ë¼ì´ì–¸íŠ¸ ì¡°ê±´ì— ë”°ë¼ ì—…ë°ì´íŠ¸ (ë‘ë²ˆì§¸ ë Œë”ë§)ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ ë°©ì‹ì„ í†µí•´ í•˜ì´ë“œë ˆì´ì…˜ ì˜¤ë¥˜ë¥¼ í”¼í•˜ë©´ì„œ í•„ìš”í•œ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<h2 id="ì°¸ê³ ">ì°¸ê³ </h2>
<ul>
  <li><a href="https://stackoverflow.com/questions/75692116/next-js-13-window-is-not-defined">stackoverflow - next-js-13-window-is-not-defined</a></li>
</ul>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="Nextjs" /><category term="prerendering" /><category term="ì„œë²„ ì»´í¬ë„ŒíŠ¸" /><category term="use client" /><category term="ì—ëŸ¬" /><summary type="html"><![CDATA[í´ë¼ì´ì–¸íŠ¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ prerendering ì—ëŸ¬ê°€ ë°œìƒí•œ ì´ìœ ]]></summary></entry><entry><title type="html">[JS] CJSì™€ ESM | ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ëª¨ë“ˆí™”</title><link href="http://localhost:4000/javascript/js-function/" rel="alternate" type="text/html" title="[JS] CJSì™€ ESM | ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ëª¨ë“ˆí™”" /><published>2024-07-09T00:00:00+09:00</published><updated>2024-07-09T22:06:00+09:00</updated><id>http://localhost:4000/javascript/js-function</id><content type="html" xml:base="http://localhost:4000/javascript/js-function/"><![CDATA[<h2 id="-ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜-ëª¨ë“ˆí™”">ğŸ“ ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ëª¨ë“ˆí™”</h2>

<p>ëª¨ë“ˆí™”ëŠ” ì½”ë“œë¥¼ ì‘ì€ ì¡°ê° ë˜ëŠ” íŒŒì¼ë¡œ ë‚˜ëˆ„ì–´ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. <br />
ì´ˆê¸° ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” í•˜ë‚˜ì˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì— ëª¨ë“  ê¸°ëŠ¥ì„ ë‹´ì•„ì•¼ í–ˆìŠµë‹ˆë‹¤. ì´ë¡œì¸í•´ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê³  ë³µì¡ì„±ì´ ì¦ê°€ë˜ëŠ” ë“± ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤. <br />
ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ì—­í• ì´ ì»¤ì§€ë©° ëª¨ë“ˆí™”ì˜ í•„ìš”ì„±ì´ ì¦ê°€í–ˆê³  CJS, ESM ë“±ì˜ ë°©ë²•ì´ ë“±ì¥í–ˆìŠµë‹ˆë‹¤.</p>

<h2 id="-cjsì™€-esm--ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼-ëª¨ë“ˆí™”-í•˜ëŠ”-ë°©ì‹">ğŸ“ CJSì™€ ESM | ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ëª¨ë“ˆí™” í•˜ëŠ” ë°©ì‹</h2>

<h3 id="-cjs-commonjs-ë°©ì‹">â–  CJS (CommonJS) ë°©ì‹</h3>

<ul>
  <li><strong>require</strong>ê³¼ <strong>module.exports</strong>ë¥¼ ì‚¬ìš©</li>
  <li>Node.js í™˜ê²½ì—ì„œ ì‚¬ìš© (ì˜¤ì§ ì„œë²„ì‚¬ì´ë“œì—ì„œë§Œ í™œìš©)</li>
  <li>ë™ê¸°ì ìœ¼ë¡œ ë¡œë“œ
    <ul>
      <li>ëª¨ë“ˆì´ ì™„ì „íˆ ë¡œë“œë˜ì–´ ì‹¤í–‰ë  ë•Œê¹Œì§€ ì½”ë“œ ì°¨ë‹¨</li>
      <li>ì‹¤í–‰ì „ ëª¨ë“  ì¢…ì†ì„±ì´ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³ ì‹¶ì€ ì„œë²„ ì¸¡ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©</li>
    </ul>
  </li>
  <li>í™•ì¥ì: <code class="language-plaintext highlighter-rouge">.cjs</code></li>
</ul>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// moduleA.js</span>
<span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello, from Module A!</span><span class="dl">"</span><span class="p">;</span>
<span class="kr">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>

<span class="c1">// moduleB.js</span>
<span class="kd">const</span> <span class="nx">messageA</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./moduleA</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="-esm-ecmascript-modules-ë°©ì‹">â–  ESM (ECMAScript Modules) ë°©ì‹</h3>

<ul>
  <li><strong>import</strong>ì™€ <strong>export</strong>ë¥¼ ì‚¬ìš©</li>
  <li>Node.js í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ë©° ìµœì‹  ë¸Œë¼ìš°ì €ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥ (ì„œë²„ì‚¬ì´ë“œì™€ ë¸Œë¼ìš°ì € í™˜ê²½ ëª¨ë‘ í™œìš©)</li>
  <li>ë™ê¸°ì ìœ¼ë¡œ ë¡œë“œ ë˜ë‚˜ ë¹„ë™ê¸° ê°€ëŠ¥
    <ul>
      <li>ESMì€ <a href="https://nodejs.org/api/esm.html#top-level-await">Top-level await</a>ë¥¼ ì§€ì›í•˜ê¸° ë•Œë¬¸ì— ê°€ëŠ¥</li>
    </ul>
  </li>
  <li>three shaking ê°€ëŠ¥
    <ul>
      <li>ì •ì  ë¶„ì„ì„ í†µí•´ ë¹Œë“œ ë‹¨ê³„ì—ì„œ(= ë²ˆë“¤ë§ëœ ì½”ë“œì—ì„œ) ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì½”ë“œë¥¼ ì œê±°</li>
      <li>ì›¹í˜ì´ì§€ ë¡œë”©ì†ë„ë¥¼ ê°œì„ í•  ìˆ˜ ìˆì–´ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì— ì í•©</li>
    </ul>
  </li>
  <li>í™•ì¥ì: <code class="language-plaintext highlighter-rouge">.mjs</code></li>
</ul>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// moduleA.mjs</span>
<span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">Hello, from Module A!</span><span class="dl">"</span><span class="p">;</span>
<span class="k">export</span> <span class="k">default</span> <span class="nx">message</span><span class="p">;</span>

<span class="c1">// moduleB.mjs</span>
<span class="k">import</span> <span class="nx">messageA</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./moduleA</span><span class="dl">"</span><span class="p">;</span>
</code></pre></div></div>
<h3 id="-cjsì™€-esm-ë¹„êµ">â–  CJSì™€ ESM ë¹„êµ</h3>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>CJS</th>
      <th>ESM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ë¬¸ë²•</td>
      <td>require, export.module</td>
      <td>import, export</td>
    </tr>
    <tr>
      <td>ì í•©ë„</td>
      <td>ì„œë²„ì¸¡ ê°œë°œì— ì í•©</td>
      <td>ëª¨ë˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì— ì í•©</td>
    </tr>
    <tr>
      <td>ë™ì  ê°€ì ¸ì˜¤ê¸°</td>
      <td>ê°€ëŠ¥í•˜ë‚˜ ì¼ë°˜ì ì´ì§€ ì•ŠìŒ</td>
      <td>o</td>
    </tr>
    <tr>
      <td>ë¹„ë™ê¸°</td>
      <td>x</td>
      <td>o</td>
    </tr>
    <tr>
      <td>ì •ì  ë¶„ì„</td>
      <td>x</td>
      <td>o</td>
    </tr>
    <tr>
      <td>three shaking</td>
      <td>x</td>
      <td>o</td>
    </tr>
    <tr>
      <td>ë¸Œë¼ìš°ì € ì§€ì›</td>
      <td>x</td>
      <td>o</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h2 id="ì¶œì²˜">ì¶œì²˜</h2>
<ul>
  <li><a href="https://dev.to/nipu/js-cjs-and-mjs-defference-5f21"><strong>.js, .cjs and .mjs defference</strong></a></li>
  <li>https://tech.kakao.com/posts/605</li>
</ul>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="JavaScript" /><category term="JavaScript" /><category term="CJS" /><category term="ESM" /></entry><entry><title type="html">[JS] ì´ë²¤íŠ¸ ë£¨í”„ì™€ ë¹„ë™ê¸° í†µì‹ </title><link href="http://localhost:4000/javascript/javascript-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84%EC%99%80-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%86%B5%EC%8B%A0/" rel="alternate" type="text/html" title="[JS] ì´ë²¤íŠ¸ ë£¨í”„ì™€ ë¹„ë™ê¸° í†µì‹ " /><published>2024-06-29T00:00:00+09:00</published><updated>2024-06-29T22:06:00+09:00</updated><id>http://localhost:4000/javascript/javascript-%EC%9D%B4%EB%B2%A4%ED%8A%B8%20%EB%A3%A8%ED%94%84%EC%99%80%20%EB%B9%84%EB%8F%99%EA%B8%B0%20%ED%86%B5%EC%8B%A0</id><content type="html" xml:base="http://localhost:4000/javascript/javascript-%EC%9D%B4%EB%B2%A4%ED%8A%B8-%EB%A3%A8%ED%94%84%EC%99%80-%EB%B9%84%EB%8F%99%EA%B8%B0-%ED%86%B5%EC%8B%A0/"><![CDATA[<h2 id="-ì‹±ê¸€-ìŠ¤ë ˆë“œ-ìë°”ìŠ¤í¬ë¦½íŠ¸">ğŸ“ ì‹±ê¸€ ìŠ¤ë ˆë“œ ìë°”ìŠ¤í¬ë¦½íŠ¸</h2>

<p>ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” <strong>ì‹±ê¸€ ìŠ¤ë ˆë“œ ì–¸ì–´</strong>ë‹¤.</p>

<p>í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ì•ˆì— ì—¬ëŸ¬ê°œì˜ ìŠ¤ë ˆë“œê°€ ìˆì„ ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” ì‹±ê¸€ ìŠ¤ë ˆë“œ ì–¸ì–´ì´ë¯€ë¡œ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ì¡´ì¬í•œë‹¤.</p>

<p>ì—¬ëŸ¬ê°œì˜ ìŠ¤ë ˆë“œê°€ ìˆë‹¤ë©´ ë©”ëª¨ë¦¬ë¥¼ ê³µìœ í•´ ë™ì‹œì— ì—¬ëŸ¬ì‘ì—…ì´ ê°€ëŠ¥í•˜ì§€ë§Œ í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ê°€ì§€ê³  ìˆëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì€ ì‘ì—…ì„ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤.</p>

<p>ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œëŠ” í•œì¤„í•œì¤„ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬ë˜ë©° í•˜ë‚˜ì˜ ì‘ì—…ì´ ëë‚˜ê¸°ì „ê¹Œì§€ ë‹¤ìŒ ì‘ì—…ì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p>ë§Œì•½ í•˜ë‚˜ì˜ ì‘ì—…ì´ ë„ˆë¬´ ì˜¤ë˜ê±¸ë¦¬ë©´ ë’¤ì— ìˆëŠ” ì‘ì—…ì´ ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë°, ì´ëŠ” <strong>Run-to-Completion</strong>ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ íŠ¹ì§•ì´ë‹¤.</p>

<ul>
  <li>í”„ë¡œì„¸ìŠ¤
    <ul>
      <li>ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ë…ë¦½ì ì¸ ì‹¤í–‰ ë‹¨ìœ„</li>
      <li>ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ì™€ ìì›ì„ ê³µìœ í•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
    </ul>
  </li>
  <li>ìŠ¤ë ˆë“œ
    <ul>
      <li>í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ ì•ˆì— ì¡´ì¬í•˜ëŠ” ì‘ì€ ì‹¤í–‰ ë‹¨ìœ„</li>
      <li>ìŠ¤ë ˆë“œë¼ë¦¬ ìì›ì„ ê³µìœ í•  ìˆ˜ ìˆë‹¤.</li>
      <li>í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ê°€ ë³‘ë ¬ë¡œ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•œë‹¤.</li>
    </ul>
  </li>
</ul>

<p><br /></p>

<h3 id="-ë©”ëª¨ë¦¬-í™ê³¼-ì½œ-ìŠ¤íƒ---ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€-ì‘ì—…ì„-ìˆ˜í–‰í•˜ëŠ”-ë°©ë²•">â—† ë©”ëª¨ë¦¬ í™ê³¼ ì½œ ìŠ¤íƒ  | ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•</h3>

<p>â–  ë©”ëª¨ë¦¬ í™ (Memory Heap)</p>
<ul>
  <li>ì„ ì–¸ëœ ë³€ìˆ˜ë“¤ì˜ ë©”ëª¨ë¦¬ í• ë‹¹ì´ ì´ë£¨ì–´ì§„ë‹¤.</li>
  <li>ë¹„êµ¬ì¡°ì ìœ¼ë¡œ ë°ì´í„°ê°€ ì €ì¥ëœë‹¤.</li>
</ul>

<p>â–  ì½œ ìŠ¤íƒ (Call Stack)</p>
<ul>
  <li>í•¨ìˆ˜ë“¤ì´ ì‹¤í–‰ ìˆœì„œì— ë”°ë¼ ìŒ“ì¸ë‹¤.</li>
  <li>LIFO(ì„ ì…í›„ì¶œ)ì˜ êµ¬ì¡°ë¡œ ì§„í–‰ëœë‹¤.</li>
</ul>

<p><img src="/assets/image/posts/js-event-loop.png" alt="image" /></p>

<p><br /></p>

<h2 id="-ì´ë²¤íŠ¸-ë£¨í”„--ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€-ë¹„ë™ê¸°-í†µì‹ ì„-í•˜ëŠ”-ë°©ë²•">ğŸ“ ì´ë²¤íŠ¸ ë£¨í”„ | ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë¹„ë™ê¸° í†µì‹ ì„ í•˜ëŠ” ë°©ë²•</h2>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">bar</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">baz</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">baz</span><span class="dl">'</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">foo</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">)</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">bar</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">baz</span><span class="p">()</span>
<span class="p">}</span>

<span class="nx">foo</span><span class="p">()</span>
</code></pre></div></div>

<ul>
  <li>ì¶œë ¥ ìˆœì„œ: foo â†’ baz â†’ bar</li>
</ul>

<p>barì˜ ì‹¤í–‰ì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ë‹¤ìŒì¤„ì¸ bazê°€ ì‹¤í–‰ëœ ì´ìœ ëŠ” setTimeout í•¨ìˆ˜ëŠ” ë°”ë¡œ ì½œìŠ¤íƒì— ë“¤ì–´ê°€ëŠ” ê²ƒì´ì•„ë‹ˆë¼ íƒœìŠ¤í¬íì— ë“¤ì–´ê°€ê¸° ë•Œë¬¸ì´ë‹¤.</p>
<ul>
  <li>íƒœìŠ¤í¬íì— ì €ì¥ë˜ëŠ” ì‘ì—…ë“¤: setTimeout, setInterval, setImmediate</li>
</ul>

<p><br /></p>

<h3 id="-ë¸Œë¼ìš°ì €-ì´ë²¤íŠ¸-ë™ì‘-ìˆœì„œ">â—† ë¸Œë¼ìš°ì € ì´ë²¤íŠ¸ ë™ì‘ ìˆœì„œ</h3>
<p><img src="/assets/image/posts/js-event-loop-2.png" alt="image" /></p>

<ol>
  <li><strong>ì½œìŠ¤íƒ</strong> ì‹¤í–‰</li>
  <li>ì½œìŠ¤íƒì´ ë¹„ì–´ìˆìœ¼ë©´ <strong>ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ í</strong> í™•ì¸. íê°€ ë¹Œ ë•Œê¹Œì§€ ëª¨ë“  ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ ì‹¤í–‰
    <ul>
      <li>í”„ë¡œë¯¸ìŠ¤ì˜ <code class="language-plaintext highlighter-rouge">then</code>ì´ë‚˜ <code class="language-plaintext highlighter-rouge">catch</code>, <code class="language-plaintext highlighter-rouge">MutationObserver</code> ë“±</li>
    </ul>
  </li>
  <li><strong>íƒœìŠ¤í¬ í</strong> í™•ì¸. íê°€ ë¹Œ ë•Œê¹Œì§€ ëª¨ë“  íƒœìŠ¤í¬ ì‹¤í–‰
    <ul>
      <li><code class="language-plaintext highlighter-rouge">setTimeout</code>, <code class="language-plaintext highlighter-rouge">setInterval</code>, I/O ì‘ì—…, DOM ì´ë²¤íŠ¸ ë“±</li>
    </ul>
  </li>
  <li><strong>Request Animation Frame</strong>ì—ì„œ ëŒ€ê¸°ì¤‘ì¸ ì½œë°± ì‹¤í–‰
    <ul>
      <li>Request Animation Frame: ì• ë‹ˆë©”ì´ì…˜ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê¸° ìœ„í•´ ì œê³µí•˜ëŠ” í•¨ìˆ˜ë¡œ ë¸Œë¼ìš°ì €ê°€ ë‹¤ìŒ ë¦¬í˜ì¸íŠ¸(Repaint) ì „ì— ì§€ì •ëœ ì½œë°± í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë„ë¡ ì˜ˆì•½</li>
    </ul>
  </li>
  <li>ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ë©´ ë¸Œë¼ìš°ì €ëŠ” <strong>ë Œë”ë§</strong>ì„ ìˆ˜í–‰í•´ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•œë‹¤.</li>
</ol>

<p><br /></p>

<h3 id="-í•¨ìˆ˜ê°€-ë§ˆì´í¬ë¡œ-íƒœìŠ¤í¬-íì—-ì €ì¥ë -ê²½ìš°">â—† í•¨ìˆ˜ê°€ ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ íì— ì €ì¥ë  ê²½ìš°</h3>

<ol>
  <li>ì½œ ìŠ¤íƒì—ì„œ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë§Œë“¤ê³  í”„ë¡œë¯¸ìŠ¤ì— ë“±ë¡ëœ ì½œë°±, ì¦‰ í”„ë¡œë¯¸ìŠ¤ê°€ ë‹¤ ìˆ˜í–‰ì´ ë˜ê³ ë‚˜ë©´ ì‹¤í–‰ë˜ëŠ”Â <code class="language-plaintext highlighter-rouge">then</code>ê³¼Â <code class="language-plaintext highlighter-rouge">mutation observer</code>ë¼ëŠ” ì›¹ APIì— ë“±ë¡ëœ ì½œë°±ì´ ë§ˆì´í¬ë¡œ íì— ë“¤ì–´ì˜¨ë‹¤.</li>
  <li>ì´ë²¤íŠ¸ë£¨í”„ëŠ” ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ íì— ìˆëŠ” í”„ë¡œë¯¸ìŠ¤ then ì½œë°±ì„ ë¹„ì–´ìˆëŠ” ì½œìŠ¤íƒìœ¼ë¡œ ê°€ì ¸ê°„ë‹¤.</li>
  <li>í”„ë¡œë¯¸ìŠ¤Â <code class="language-plaintext highlighter-rouge">then</code>ì´ ëë‚˜ë©´Â <code class="language-plaintext highlighter-rouge">mutation obsever</code>ë¥¼ ì½œ ìŠ¤íƒìœ¼ë¡œ ê°€ì ¸ê°„ë‹¤.</li>
</ol>

<p><strong>â­ï¸ í¬ì¸íŠ¸ 1</strong> ì´ ê³¼ì •ì—ì„œ ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ íì— ìƒˆë¡œìš´ í•¨ìˆ˜ê°€ ë“¤ì–´ì˜¨ë‹¤ë©´, ë‚˜ì¤‘ì— ë“¤ì–´ì˜¨ í•¨ìˆ˜ë„ ëª¨ë‘ ëë‚ ë•Œê¹Œì§€ ê³„ì† ì½œìŠ¤íƒìœ¼ë¡œ ê°€ì§€ê³  ì™€ì„œ ìˆ˜í–‰í•œë‹¤. <br />
<strong>â­ï¸ í¬ì¸íŠ¸ 2</strong> ë§ˆì´í¬ë¡œ íƒœìŠ¤í¬ íê°€ í……í……ë¹„ë©´ í…ŒìŠ¤í¬ íë¡œ ë„˜ì–´ê°„ë‹¤.(íƒœìŠ¤í¬ íì™€ì˜ ì°¨ì´ì : íƒœìŠ¤í¬ íì—ì„œëŠ” ì•„ì´í…œ í•˜ë‚˜ë§Œ ì½œìŠ¤íƒìœ¼ë¡œ ë³´ë‚´ê³  ê¸°ë‹¤ë¦°ë‹¤.)</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">handleClick</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">handleClick</span><span class="dl">"</span><span class="p">);</span>
  <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// promise ì˜ ì½œë°±ì€ Microtask queë¥¼ ì´ìš©í•œë‹¤.</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">then</span><span class="dl">"</span><span class="p">);</span>
      <span class="nx">handleClick</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">handleClick</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>ì´ë²¤íŠ¸ë£¨í”„ëŠ” ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ íì— ë“±ë¡ëœ ì½œë°±ì´ ëª¨ë‘ ë¹Œë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°ë•Œë¬¸ì— ì´ë²¤íŠ¸ë£¨í”„ê°€ ë©ˆì¶° ë¸Œë¼ìš°ì €ê°€ ë°˜ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.</p>

<p><br /></p>

<h3 id="-í•¨ìˆ˜ê°€-íƒœìŠ¤í¬-íì—-ì €ì¥ë -ê²½ìš°">â—† í•¨ìˆ˜ê°€ íƒœìŠ¤í¬ íì— ì €ì¥ë  ê²½ìš°</h3>

<ol>
  <li>ë¸Œë¼ìš°ì €ì—ì„œ ì§€ì •ëœ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œë‹¤.</li>
  <li>ì›¹ APIëŠ” ì½œë°±í•¨ìˆ˜ë¥¼ íƒœìŠ¤í¬ íì— ë„£ì–´ì¤€ë‹¤.</li>
  <li>ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ê³„ì† ê´€ì°°ì„ í•˜ë‹¤ê°€ ì½œ ìŠ¤íƒì— í• ì¼ì´ ë‚¨ì•„ ìˆìœ¼ë©´ ì½œìŠ¤íƒì´ ë¹„ì›Œì§ˆ ë–„ê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.</li>
  <li>ì½œìŠ¤íƒì´ ë¹„ì–´ì„œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì´ ë”ì´ìƒ ì¼ì„ í•˜ì§€ ì•Šì„ ë•Œ íƒœìŠ¤í¬ íì— ìˆëŠ” í•¨ìˆ˜ë¥¼ ì½œ ìŠ¤íƒìœ¼ë¡œ ê°€ì ¸ì˜¨ë‹¤.</li>
  <li>ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—”ì§„ì´ ì½œ ìŠ¤íƒì— ë“¤ì–´ì˜¨ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•œë‹¤.</li>
</ol>

<p><strong>â­ï¸ í¬ì¸íŠ¸ 1</strong> ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œìŠ¤íƒì— ìˆëŠ” í•¨ìˆ˜ë¥¼ <strong>í•˜ë‚˜ì”©ë§Œ</strong> ê°€ì ¸ì˜¨ë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">handleClick</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">handleClick</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">setTimeout</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">handleClick</span><span class="p">();</span> <span class="c1">// ì½œìŠ¤íƒì— ë¬´í•œìœ¼ë¡œ ì¶”ê°€ë˜ì–´ ë™ì¼í•œ ë‚´ìš©ì˜ ì´ë²¤íŠ¸ë£¨í”„ê°€ ë°˜ë³µëœë‹¤.</span>
  <span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">handleClick</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>
<p>ì½œë°±í•¨ìˆ˜ ë‚´ì—ì„œ ë‹¤ì‹œ ì½œë°±í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— Task Queueì— ë¬´í•œìœ¼ë¡œ í•¨ìˆ˜ê°€ ì¶”ê°€ëœë‹¤.</p>

<p><br /></p>

<h3 id="-í•¨ìˆ˜ê°€-request-animation-frame-queueì—-ì €ì¥ë -ê²½ìš°">â—† í•¨ìˆ˜ê°€ Request Animation Frame Queueì— ì €ì¥ë  ê²½ìš°</h3>

<p>ë¸Œë¼ìš°ì €ë¥¼ ë‹¤ì‹œ ì—…ë°ì´íŠ¸ í•  ë•ŒëŠ” renderì•ˆì˜ request Animation Frame ì— ë“±ë¡ëœ ì½œë°±ë“¤ì„ ê±°ì¹œ í›„ ë Œë” íŠ¸ë¦¬ë¥¼ ë§Œë“¤ê³  ê·¸ íŠ¸ë¦¬ë¥¼ ì´ìš©í•´ì„œ ë ˆì´ì•„ì›ƒì„ ê³„ì‚°í•œ ë’¤ì— í˜ì¸íŠ¸ë¥¼ í†µí•´ì„œ ë¸Œë¼ìš°ì €ì— ì—…ë°ì´íŠ¸ë¥¼ í•œ ë‹¤ìŒì— ì´ë²¤íŠ¸ë£¨í”„ê°€ ì¬ê°œëœë‹¤.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ë Œë”ë§ì´ ë˜ê¸° ì „ ë¸Œë¼ìš°ì €ê°€ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ë³´ì¥í•´ì¤€ë‹¤.</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">beige</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">orange</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">});</span>
  <span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">red</span><span class="dl">"</span><span class="p">;</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>íëŠ” FIFOì˜ êµ¬ì¡°ë¥¼ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì— ë§ˆì§€ë§‰ì— ë“¤ì–´ì˜¨ ì½”ë“œê°€ ê°€ì¥ ë¨¼ì € ì ìš©ë˜ê¸° ë•Œë¬¸ì— ìµœì¢…ì ìœ¼ë¡œ ë¹¨ê°„ìƒ‰ì´ ì ìš©ëœ ìƒíƒœì—ì„œ ë Œë”íŠ¸ë¦¬ê°€ ë§Œë“¤ì–´ì§€ê³  ë¸Œë¼ìš°ì €ì— í‘œê¸°ê°€ ì™„ë£Œëœë‹¤.</p>

<h2 id="ì¶œì²˜">ì¶œì²˜</h2>

<ul>
  <li>ë“œë¦¼ì½”ë”©</li>
  <li>ëª¨ë˜ ë¦¬ì•¡íŠ¸ ë”¥ë‹¤ì´ë¸Œ</li>
  <li>ëª¨ë˜ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë”¥ë‹¤ì´ë¸Œ</li>
</ul>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="JavaScript" /><category term="ë¹„ë™ê¸°" /><category term="ì´ë²¤íŠ¸ë£¨í”„" /><summary type="html"><![CDATA[ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë¹„ë™ê¸° í†µì‹ ì„ í•˜ëŠ” ë°©ë²•]]></summary></entry><entry><title type="html">[JS] MSW(Mock Service Worker, v 2.0) - API Mocking í•˜ê¸°</title><link href="http://localhost:4000/javascript/javascript-MSW(Mock-Service-Worker,-v-2.0)/" rel="alternate" type="text/html" title="[JS] MSW(Mock Service Worker, v 2.0) - API Mocking í•˜ê¸°" /><published>2024-06-24T00:00:00+09:00</published><updated>2024-06-24T22:06:00+09:00</updated><id>http://localhost:4000/javascript/javascript-MSW(Mock%20Service%20Worker,%20v%202.0)</id><content type="html" xml:base="http://localhost:4000/javascript/javascript-MSW(Mock-Service-Worker,-v-2.0)/"><![CDATA[<h2 id="-mswë€">ğŸ“„ MSWë€?</h2>

<p><a href="https://mswjs.io/">MSW</a>ëŠ” Mock Service Workerì˜ ì•½ìë¡œ <strong>API ëª¨í‚¹</strong>ì„ ìœ„í•œ ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.</p>

<p>ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<ul>
  <li>ë°±ì—”ë“œ APIê°€ ë¯¸ì™„ì„±ì¼ ê²½ìš° ë¯¸ë¦¬ ë¡œì§ì„ êµ¬ì„±í•´ì•¼í•  ë•Œ</li>
  <li>íŠ¹ì • ì—ëŸ¬ë¥¼ ë°œìƒì‹œì¼œ ì—ëŸ¬ í•¸ë“¤ë§ í…ŒìŠ¤íŠ¸ í•  ë•Œ</li>
</ul>

<p>MSWëŠ” <strong>Service Worker API</strong>ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì €ì—ì„œ ë°œìƒí•˜ëŠ” ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ê°€ë¡œì±•ë‹ˆë‹¤. ì‹¤ì œ ì„œë²„ ëŒ€ì‹  ê°€ì§œ ì‘ë‹µì„ ë§Œë“¤ì–´ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìê°€ API í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.</p>

<p>ì‚¬ë‚´ í”„ë¡œì íŠ¸ì—ì„œ API ì „ë‹¬ì´ ëŠ¦ì–´ì§€ë©° í”„ë¡ íŠ¸ì—”ë“œì—ì„œ API ìš”ì²­ ë¡œì§ì„ ë¯¸ë¦¬ êµ¬í˜„í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ MSWë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤. ë¯¸ë¦¬ DTOë¥¼ ì „ë‹¬ë°›ìœ¼ë©´ ì¶”í›„ ì‹¤ì œ APIë¥¼ ì „ë‹¬ë°›ì•˜ì„ ë•Œ í° ê³µìˆ˜ì—†ì´ ë°”ë¡œ APIë¥¼ ì—°ê²° í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ì²˜ëŸ¼ ì „ì—­ìœ¼ë¡œ ì„¤ì •ì„ í•´ ì˜ˆìƒì¹˜ ëª»í•œ ë„¤íŠ¸ì›Œí¬ë¥¼ ê°€ë¡œì±„ëŠ” ìƒí™©ì„ í”¼í•˜ê¸° ìœ„í•´ ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•˜ê³  ì‹¤ì œ ë¦´ë¦¬ì¦ˆë˜ëŠ” ë¸Œëœì¹˜ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>

<p><br /></p>

<h2 id="msw-ì„¤ì¹˜-nextjs-app-router-í™˜ê²½-ê¸°ì¤€">ğŸ“„MSW ì„¤ì¹˜ (Next.js App Router í™˜ê²½ ê¸°ì¤€)</h2>

<p>Next.jsì—ì„œ MSWë¥¼ ì‚¬ìš©í•  ê²½ìš° í´ë¼ì´ì–¸íŠ¸/ì„œë²„ í™˜ê²½ ëª¨ë‘ ìš”êµ¬ë˜ëŠ”ë°, ê¸€ ì‘ì„± ì‹œì  ê¸°ì¤€ ì„œë²„ ì‚¬ì´ë“œì—ì„œ mswê³¼ ë§¤ë„ëŸ½ê²Œ í˜¸í™˜í•˜ëŠ” ë°©ë²•ì´ ì—†ì–´ node ì„œë²„ì™€ í•¨ê»˜ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<div style="border-left: 5px solid #3498db; padding: 10px; background: #f0f8ff;">
<strong>â„¹ï¸ Notice:</strong> Next.jsì—ì„œ MSWë¥¼ ì‚¬ìš©í•  ê²½ìš° í´ë¼ì´ì–¸íŠ¸/ì„œë²„ í™˜ê²½ ëª¨ë‘ ìš”êµ¬ë˜ëŠ”ë°, ê¸€ ì‘ì„± ì‹œì  ê¸°ì¤€ ì„œë²„ ì‚¬ì´ë“œì—ì„œ mswê³¼ ë§¤ë„ëŸ½ê²Œ í˜¸í™˜í•˜ëŠ” ë°©ë²•ì´ ì—†ì–´ node ì„œë²„ì™€ í•¨ê»˜ ì‚¬ìš©í•©ë‹ˆë‹¤.
</div>

<h3 id="1-ì„¤ì¹˜í•˜ê¸°">1. ì„¤ì¹˜í•˜ê¸°</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="nx">msw</span><span class="p">@</span><span class="nd">latest</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
</code></pre></div></div>

<h3 id="2-public-í´ë”ì—-ì´ˆê¸°í™”">2. public í´ë”ì— ì´ˆê¸°í™”</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">npx</span> <span class="nx">msw</span> <span class="nx">init</span> <span class="k">public</span><span class="sr">/ --sav</span><span class="err">e
</span></code></pre></div></div>
<ul>
  <li>public í´ë”ì— ì„¤ì¹˜</li>
  <li><strong>mockServiceWorker.js</strong> ê°€ ìë™ìœ¼ë¡œ ìƒì„±
    <ul>
      <li>http ìš”ì²­ì„ ê°€ë¡œì±„ ì„œë²„ì™€ì˜ í†µì‹ ì„ ëª¨ë°©í•œë‹¤.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">--save</code> : package.json ì— ë“±ë¡ë˜ì–´ mswë¥¼ ì—…ë°ì´íŠ¸ í•  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸</li>
</ul>

<p><br /></p>

<h2 id="-msw-ì„¸íŒ…">ğŸ“„ MSW ì„¸íŒ…</h2>

<h3 id="-srcmocksbrowserts">ğŸ’¾ src/mocks/browser.ts</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">setupWorker</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">msw/browser</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">handlers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./handlers</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// This configures a Service Worker with the given request handlers.</span>
<span class="kd">const</span> <span class="nx">worker</span> <span class="o">=</span> <span class="nx">setupWorker</span><span class="p">(...</span><span class="nx">handlers</span><span class="p">);</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">worker</span><span class="p">;</span>
</code></pre></div></div>
<ul>
  <li>CSR ë„¤íŠ¸ì›Œí¬ ìš”ì²­ìš©</li>
  <li>serviceWorkerê°€ ê°€ë¡œì±ˆ ë¸Œë¼ìš°ì € ìš”ì²­ì„ ì „ë‹¬ë°›ëŠ”ë‹¤.</li>
</ul>

<h3 id="-srcmockshttpts">ğŸ’¾ src/mocks/http.ts</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createMiddleware</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@mswjs/http-middleware</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">express</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">cors</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">cors</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">handlers</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./handlers</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">9090</span><span class="p">;</span> <span class="c1">// ì„œë²„ í¬íŠ¸</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">({</span> <span class="na">origin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:3000</span><span class="dl">'</span><span class="p">,</span> <span class="na">optionsSuccessStatus</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="na">credentials</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">createMiddleware</span><span class="p">(...</span><span class="nx">handlers</span><span class="p">));</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Mock server is running on port: </span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">`</span><span class="p">));</span>
</code></pre></div></div>
<ul>
  <li>SSR ë„¤íŠ¸ì›Œí¬ ìš”ì²­ìš© =  ì„œë²„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©</li>
  <li>CSRë§Œ ì‚¬ìš©í•  ê²½ìš° í•„ìˆ˜ëŠ” ì•„ë‹˜</li>
</ul>

<h3 id="-srcmockshandlerts">ğŸ’¾ src/mocks/handler.ts</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">http</span><span class="p">,</span> <span class="nx">HttpResponse</span><span class="p">,</span> <span class="nx">StrictResponse</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">msw</span><span class="dl">'</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">faker</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@faker-js/faker</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">generateDate</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">lastWeek</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">());</span>
  <span class="nx">lastWeek</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">lastWeek</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">-</span> <span class="mi">7</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">date</span><span class="p">.</span><span class="nx">between</span><span class="p">({</span>
    <span class="na">from</span><span class="p">:</span> <span class="nx">lastWeek</span><span class="p">,</span>
    <span class="na">to</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="kd">const</span> <span class="nx">User</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span><span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">elonmusk</span><span class="dl">'</span><span class="p">,</span> <span class="na">nickname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Elon Musk</span><span class="dl">'</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/yRsRRjGO.jpg</span><span class="dl">'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">zerohch0</span><span class="dl">'</span><span class="p">,</span> <span class="na">nickname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ì œë¡œì´ˆ</span><span class="dl">'</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/5Udwvqim.jpg</span><span class="dl">'</span><span class="p">},</span>
  <span class="p">{</span><span class="na">id</span><span class="p">:</span> <span class="dl">'</span><span class="s1">leoturtle</span><span class="dl">'</span><span class="p">,</span> <span class="na">nickname</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ë ˆì˜¤</span><span class="dl">'</span><span class="p">,</span> <span class="na">image</span><span class="p">:</span> <span class="nx">faker</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">avatar</span><span class="p">()},</span>
<span class="p">]</span>
<span class="kd">const</span> <span class="nx">Posts</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">handlers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/login</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ë¡œê·¸ì¸</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">HttpResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">User</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">Set-Cookie</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">connect.sid=msw-cookie;HttpOnly;Path=/</span><span class="dl">'</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}),</span>
  <span class="nx">http</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/logout</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">ë¡œê·¸ì•„ì›ƒ</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">HttpResponse</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
      <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">'</span><span class="s1">Set-Cookie</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">connect.sid=;HttpOnly;Path=/;Max-Age=0</span><span class="dl">'</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}),</span>
<span class="c1">// ...</span>
<span class="p">];</span>
</code></pre></div></div>
<ul>
  <li>API ìš”ì²­ê³¼ ì‘ë‹µ ì •ì˜</li>
</ul>

<h3 id="ì¿¼ë¦¬-íŒŒë¼ë¯¸í„°-ì²˜ë¦¬í•˜ê¸°">ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì²˜ë¦¬í•˜ê¸°</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nx">http</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/test/search</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">({</span> <span class="nx">request</span><span class="p">,</span> <span class="nx">params</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">keword</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">keyword</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">page</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">page</span><span class="dl">'</span><span class="p">));</span>
        <span class="kd">const</span> <span class="nx">size</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">size</span><span class="dl">'</span><span class="p">));</span>
        <span class="kd">const</span> <span class="nx">totalCount</span> <span class="o">=</span> <span class="nx">searchParams</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">totalPages</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nx">totalCount</span> <span class="o">/</span> <span class="nx">size</span><span class="p">);</span>


        <span class="k">return</span> <span class="nx">HttpResponse</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
            <span class="na">result</span><span class="p">:</span> <span class="dl">'</span><span class="s1">SUCCESS</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">resultCode</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ì„±ê³µ</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">contents</span><span class="p">:</span> <span class="nx">test</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">page</span> <span class="o">*</span> <span class="nx">size</span><span class="p">,</span> <span class="p">(</span><span class="nx">page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nx">size</span><span class="p">),</span>
            <span class="na">pageNumber</span><span class="p">:</span> <span class="nx">page</span><span class="p">,</span>
            <span class="na">pageSize</span><span class="p">:</span> <span class="nx">size</span><span class="p">,</span>
            <span class="nx">totalPages</span><span class="p">,</span>
            <span class="nx">totalCount</span><span class="p">,</span>
            <span class="na">isLastPage</span><span class="p">:</span> <span class="nx">totalPages</span> <span class="o">&lt;=</span> <span class="nx">page</span><span class="p">,</span>
            <span class="na">isFirstPage</span><span class="p">:</span> <span class="nx">page</span> <span class="o">===</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">});</span>

    <span class="p">})</span>
</code></pre></div></div>
<ul>
  <li>url ê°ì²´ ìƒì„± í›„ searchParamsì„ í†µí•´ ì²˜ë¦¬í•©ë‹ˆë‹¤.</li>
</ul>

<p><br /></p>

<h2 id="-msw-ì„œë²„-ì‹¤í–‰">ğŸ“„ MSW ì„œë²„ ì‹¤í–‰</h2>

<h3 id="1-packagejson-ìŠ¤í¬ë¦½íŠ¸-ì¶”ê°€">1. package.json ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">scripts</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
  <span class="dl">"</span><span class="s2">dev</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next dev</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">build</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next build</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">start</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next start</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">lint</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">next lint</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">mock</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">npx tsx watch ./src/mocks/http.ts</span><span class="dl">"</span>
<span class="p">},</span>
</code></pre></div></div>
<ul>
  <li>watch : ì„œë²„ ì½”ë“œê°€ ìˆ˜ì •ë˜ë©´ ìë™ìœ¼ë¡œ ì¬ì‹œì‘</li>
</ul>

<h3 id="2-ì‹¤í–‰">2. ì‹¤í–‰</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span> <span class="nx">npm</span> <span class="nx">run</span> <span class="nx">mock</span>
</code></pre></div></div>
<p><br /></p>

<h2 id="-msw-ì‚¬ìš©-ë¶„ê¸°ì²˜ë¦¬">ğŸ“„ MSW ì‚¬ìš© ë¶„ê¸°ì²˜ë¦¬</h2>

<h3 id="-srcapp_componentmswcoponenttsx">ğŸ’¾ src\app_component\MSWCoponent.tsx</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="dl">"</span><span class="s2">use client</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">useEffect</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">react</span><span class="dl">"</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">MSWComponent</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">useEffect</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NEXT_PUBLIC_API_MOCKING</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">enabled</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
			 <span class="nx">worker</span><span class="p">.</span><span class="nx">start</span><span class="p">({</span> <span class="na">onUnhandledRequest</span><span class="p">:</span> <span class="dl">"</span><span class="s2">bypass</span><span class="dl">"</span> <span class="p">});</span> <span class="c1">// msw í•¸ë“¤ëŸ¬ë¡œ ìš”ì²­í•˜ì§€ ì•Šì€ requestëŠ” ë¬´ì‹œ. console ê²½ê³ ë¥¼ ì—†ì•¨ ìˆ˜ ìˆë‹¤</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">[]);</span>

  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>
<ul>
  <li>MSWëŠ” ê°œë°œí™˜ê²½ì—ì„œë§Œ ì‚¬ìš©í•œë‹¤</li>
</ul>

<h3 id="-envlocal">ğŸ’¾ env.local</h3>
<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">NEXT_PUBLIC_API_MOCKING</span><span class="o">=</span><span class="nx">enabled</span> 
</code></pre></div></div>
<ul>
  <li>ë¡œì»¬ í™˜ê²½ì—ì„œë§Œ ëŒì•„ê°€ëŠ” í™˜ê²½ë³€ìˆ˜ íŒŒì¼</li>
  <li>ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì½ì–´ì˜¬ ìˆ˜ ìˆëŠ” ë¸Œë¼ìš°ì € í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì—¬ ë°°í¬í™˜ê²½ì¼ë•ŒëŠ” MSWë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
</ul>

<h3 id="-srcapplayouttsx">ğŸ’¾ src\app\layout.tsx</h3>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">RootLayout</span><span class="p">({</span> <span class="nx">children</span> <span class="p">}:</span> <span class="nx">Props</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="nx">html</span> <span class="nx">lang</span><span class="o">=</span><span class="dl">"</span><span class="s2">en</span><span class="dl">"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">body</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">inter</span><span class="p">.</span><span class="nx">className</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="p">{</span><span class="nx">styles</span><span class="p">.</span><span class="nx">container</span><span class="p">}</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">MSWComponent</span> <span class="o">/&gt;</span> <span class="c1">// âœ…</span>
          <span class="p">{</span><span class="nx">children</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span>  <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="ì¶œì²˜">ì¶œì²˜</h2>

<ul>
  <li>Next.js + ReactQueryë¡œ SNS ì„œë¹„ìŠ¤ ë§Œë“¤ê¸° (ì¸í”„ëŸ°)</li>
</ul>]]></content><author><name>ìˆ˜ì§„â€ (æ°´ç)</name></author><category term="JavaScript" /><category term="MSW" /><category term="Mock" /><summary type="html"><![CDATA[í”„ë¡ íŠ¸ ì‘ì—…ì„ ì™„ë£Œí–ˆëŠ”ë° ë°±ì—”ë“œ API ì‘ì—…ì´ ëŠ¦ì–´ì§ˆ ë•Œ]]></summary></entry></feed>