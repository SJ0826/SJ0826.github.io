---
title: "[React-Query 02] ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¡œ í˜ì´ì§€ë„¤ì´ì…˜ ì‘ì—…í•˜ê¸°"
excerpt: "ë‹¤ìŒ í˜ì´ì§€ ë°ì´í„° í”„ë¦¬í˜ì¹­í•˜ê¸°"
toc: true
toc_sticky: true
sidebar:
  nav: "docs"

categories:
  - React
tags:
  - ["prefetching", "keepPreviousData"]
last_modified_at: 2023-05-08T08:06:00-05:00
---

## ğŸ“„ í˜ì´ì§€ë„¤ì´ì…˜ ì‘ì—…ì— ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ê°€ í•˜ëŠ” ì¼

í˜ì´ì§€ë„¤ì´ì…˜ ì‘ì—…ì—ì„œ ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ì„ ëˆŒë €ì„ ê²½ìš°ì— ë¦¬ì•¡íŠ¸ëŠ” ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ apië¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.

ì´ë•Œ ì‚¬ìš©ìëŠ” ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì‹œê°„ë§Œí¼ ê¸°ë‹¤ë ¤ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì ê²½í—˜ì´ ì•ˆì¢‹ì•„ì§€ëŠ” ê²°ê³¼ë¥¼ ì´ˆë˜í•©ë‹ˆë‹¤.

ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•´ í˜¸ì¶œ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¶ˆëŸ¬ì˜¤ëŠ” ì‘ì—…, ì¦‰ **í”„ë¦¬í˜ì¹­(Prefetching)**ì„ ì‚¬ìš©í•´ ë¯¸ë¦¬ ë‹¤ìŒ í˜ì´ì§€ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤ë©´ ì‚¬ìš©ìëŠ” í˜ì´ì§€ì— ë‚˜íƒ€ë‚  ì •ë³´ë¥¼ ìœ„í•´ ê¸°ë‹¤ë¦´ í•„ìš”ì„±ì´ ì‚¬ë¼ì§€ê²Œ ë©ë‹ˆë‹¤.

> ğŸ“Œ í”„ë¦¬í˜ì¹­(Prefetching)ì´ë€?
> í˜¸ì¶œ ê°€ëŠ¥ì„±ì´ ìˆëŠ” ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¶ˆëŸ¬ì˜¤ëŠ” ì‘ì—…. ë°ì´í„°ë¥¼ ë¯¸ë¦¬ ë¶ˆëŸ¬ì™€ ìºì‹œì— ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.

## ğŸ“„ ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ë¡œ í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„í•˜ê¸°

### 1. ì¿¼ë¦¬ ì„¤ì •í•˜ê¸°

í˜ì´ì§€ë„¤ì´ì…˜ì„ ìœ„í•´ ì¿¼ë¦¬ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

í˜ì´ì§€ ë³„ ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ ì¿¼ë¦¬í•¨ìˆ˜ë¡œ ì„¤ì •í–ˆëŠ”ë° ì´ë•Œ ì¿¼ë¦¬í‚¤ë¥¼ ë™ì¼í•˜ê²Œ í•œë‹¤ë©´ ëª¨ë“  í˜ì´ì§€ê°€ ê°™ì€ ì •ë³´ë¥¼ í‘œì‹œí•˜ê²Œ ë©ë‹ˆë‹¤.

ì¿¼ë¦¬í‚¤ë¥¼ ë™ì¼í•˜ê²Œ í–ˆì„ ê²½ìš° ì–´ë–¤ íŠ¸ë¦¬ê±°ê°€ ìˆì–´ì•¼ë§Œ ë°ì´í„°ë¥¼ ë¦¬í˜ì¹­í•  ìˆ˜ ìˆëŠ”ë° ë‹¤ìŒ í˜ì´ì§€ ë²„íŠ¼ì„ í´ë¦­í•œë‹¤ê³  íŠ¸ë¦¬ê±°ê°€ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

íŠ¸ë¦¬ê±°ê°€ ë°œìƒí•˜ëŠ” ê¸°ì¤€ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

1. ì»´í¬ë„ŒíŠ¸ ë¦¬ë§ˆìš´íŠ¸
2. ìœˆë„ìš° ë¦¬í¬ì»¤ì§•
3. ë¦¬í˜ì¹­í•¨ìˆ˜ ì‹¤í–‰
4. ìë™ ë¦¬í˜ì¹­
5. mutation ì´í›„ ì¿¼ë¦¬ ë¬´íš¨í™”

ì´ì „/ë‹¤ìŒ ë²„íŠ¼ì„ í´ë¦­í–ˆì„ ë•Œ íŠ¸ë¦¬ê±°ê°€ ë°œìƒí•˜ë„ë¡ **ì¿¼ë¦¬í‚¤ë¥¼ ë°°ì—´ë¡œ**ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

```js
const { data, isError, error, isLoading } = useQuery(
  ["posts", currentPage], // ğŸ‰
  () => fetchPosts(currentPage),
  {
    staleTime: 2000,
    keepPreviousData: true,
  }
);
if (isLoading) return <h3>Loading...</h3>;
if (isError)
  return (
    <>
      <h3>Oops, something went wrong</h3>
      <p>{error.toString()}</p>
    </>
  );
```

> ğŸ“Œ keepPreviousData: ìƒˆ ë°ì´í„°ê°€ ìš”ì²­ë˜ëŠ” ë™ì•ˆ ë§ˆì§€ë§‰ìœ¼ë¡œ ì„±ê³µí•œ fetch Dataë¡œ ìœ ì§€í•´ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.

### 2. í”„ë¦¬í˜ì¹­ í•¨ìˆ˜ ì„¤ì •í•˜ê¸°

í˜„ì¬ í˜ì´ì§€ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í”„ë¦¬í˜ì¹­ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ **useEffect**í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

```js
useEffect(() => {
  if (currentPage < maxPostPage) {
    const nextPage = currentPage + 1;
    queryClient.prefetchQuery(["posts", nextPage], () => fetchPosts(nextPage));
  }
}, [currentPage, queryClient]);
```

ìµœëŒ€ í˜ì´ì§€ (`maxPostPage`)ì—ì„œëŠ” ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ if ì¡°ê±´ë¬¸ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ì¿¼ë¦¬ë¥¼ ì„¤ì •í–ˆì„ ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì¿¼ë¦¬í‚¤ë¥¼ ë°°ì—´ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

### 3. return í•¨ìˆ˜ ì‘ì„±í•˜ê¸°

ê° ë²„íŠ¼ì˜ `disabled` ì†ì„±ì„ ì´ìš©í•´ í˜ì´ì§€ê°€ 1ì¼ ê²½ìš°, ìµœëŒ€ í˜ì´ì§€ì¼ ê²½ìš°ì— ë²„íŠ¼ì´ ë¹„í™œì„±í™” ë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.

```js
<div className="pages">
  <button
    disabled={currentPage <= 1}
    onClick={() => {
      setCurrentPage((previosValue) => previosValue - 1);
    }}
  >
    Previous page
  </button>
  <span>Page {currentPage}</span>
  <button
    disabled={currentPage >= maxPostPage}
    // onClickí•¨ìˆ˜ì— í”„ë¦¬í˜ì¹­ ì‘ì—…ì„ í•˜ì§€ ì•ŠëŠ” ì´ìœ : setStateí•¨ìˆ˜ëŠ” ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— í˜„ì¬ í˜ì´ì§€ê°€ ë¬´ì—‡ì¸ì§€ ì •í™•íˆ ì•Œ ë°©ë²•ì´ ì—†ë‹¤.
    onClick={() => {
      setCurrentPage((previousValue) => previousValue + 1);
    }}
  >
    Next page
  </button>
</div>
```

í”„ë¦¬í˜ì¹­ í•¨ìˆ˜ë¥¼ onClickí•¨ìˆ˜ì— ë°”ë¡œ ì‘ì„±í•˜ì§€ ì•Šì€ ì´ìœ ê°€ ìˆìŠµë‹ˆë‹¤.

setStateí•¨ìˆ˜ëŠ” ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— í”„ë¦¬í˜ì¹­ì´ ì§„í–‰ë  ì‹œì ì—ëŠ” í˜„ì¬ í˜ì´ì§€ê°€ ë¬´ì—‡ì¸ì§€ ì •í™•íˆ ì•Œ ë°©ë²•ì´ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ useEffectì˜ ì˜ì¡´ì„± ë°°ì—´ì— ì¡°ê±´ì„ ê±¸ì–´ í”„ë¦¬í˜ì¹­ì´ ì‹¤í–‰ë˜ë„ë¡ í•˜ëŠ” ê²ƒì´ ì í•©í•©ë‹ˆë‹¤.

## ì°¸ê³ 

- [udemy - React Query: Reactë¡œ ì„œë²„ ìƒíƒœ ê´€ë¦¬í•˜ê¸°](https://www.udemy.com/course/react-query-react/)
